

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Running Intel® Edge Insights for Industrial &mdash; EII Documentation v1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Release Notes" href="release.html" />
    <link rel="prev" title="Architecture" href="architecture.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> EII Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">INTRODUCTION:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="legal.html">Legal Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#terminology">Terminology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="introduction.html#general-terminology">General Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="introduction.html#security-related-terminology">Security-Related Terminology</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running Intel® Edge Insights for Industrial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#minimum-system-requirements">Minimum System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#downloading-and-installation-from-opensource-github-repository">Downloading and Installation from Opensource Github Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="#eii-prerequisites-installation">EII Prerequisites installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generate-deployment-and-configuration-files">Generate deployment and configuration files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-consolidated-docker-compose-yml-and-eii-config-json-files">Generating consolidated docker-compose.yml and eii_config.json files:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-builder-script">Using builder script</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-builder-to-generate-the-above-listed-consolidated-files-for-all-applicable-eii-services">Running builder to generate the above listed consolidated files for all applicable EII services</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-builder-to-generate-the-above-listed-consolidated-files-for-a-subset-of-eii-services">Running builder to generate the above listed consolidated files for a subset of EII services:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-builder-to-generate-multi-instance-configs">Running builder to generate multi instance configs:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-builder-to-generate-benchmarking-configs">Running builder to generate benchmarking configs:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#provision">Provision</a></li>
<li class="toctree-l2"><a class="reference internal" href="#distribution-of-eii-container-images">Distribution of EII container images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-all-eii-services">List of All EII Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common-eii-services">Common EII services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#video-related-services">Video related services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#timeseries-related-services">Timeseries related services</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dev-mode-and-profiling-mode">Dev mode and Profiling mode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dev-mode">Dev Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-the-eii-in-dev-mode">Starting the EII in Dev Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#profiling-mode">Profiling Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-and-run-eii-video-timeseries-use-cases">Build and Run EII video/timeseries use cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#build-eii-stack">Build EII stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-eii-services">Run EII services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#push-required-eii-images-to-docker-registry">Push required EII images to docker registry</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#eii-multi-node-cluster-provision-and-deployment">EII multi node cluster provision and deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#without-orchestrator"><strong>Without orchestrator</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#ansible-based-eii-prequisites-setup-provisioning-build-deployment">Ansible based EII Prequisites setup, provisioning, build &amp; deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-ansible-on-ubuntu-control-node">Installing Ansible on Ubuntu {Control node}</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisite-step-needed-for-all-the-control-worker-nodes">Prerequisite step needed for all the control/worker nodes.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#generate-ssh-key-for-all-nodes">Generate SSH KEY for all nodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-ssh-authorized-key-from-control-node-to-all-the-nodes">Adding SSH Authorized Key from control node to all the nodes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-sudoers-file-to-accept-no-password-for-sudo-operation">Configure Sudoers file to accept NO PASSWORD for sudo operation.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#updating-the-leader-worker-node-s-information-for-using-remote-hosts">Updating the leader &amp; worker node’s information for using remote hosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-orchestrated-multi-node-deployment-without-k8s">Non-orchestrated multi node deployment (without k8s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#select-eii-services-to-run-on-a-particular-node-in-multinode-deployment">Select EII services to run on a particular node in multinode deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#execute-ansible-playbook-from-eii-workdir-iedgeinsights-build-ansible-control-node-to-deploy-eii-services-in-single-multi-nodes">Execute ansible Playbook from [EII_WORKDIR]/IEdgeInsights/build/ansible {Control node} to deploy EII services in single/multi nodes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#deploying-eii-using-helm-in-kubernetes-k8s-environment">Deploying EII Using Helm in Kubernetes (k8s) environment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#with-k8s-orchestrator"><strong>With k8s orchestrator</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-requisites">Pre requisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#update-the-helm-charts-directory">Update the helm charts directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#provision-and-deploy-in-the-kubernetes-node">Provision and deploy in the kubernetes node.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#provision-and-deploy-mode-in-times-switching-between-dev-and-prod-mode-or-changing-the-usecase">Provision and deploy mode in times switching between dev and prod mode OR changing the usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#steps-to-enable-accelarators">Steps to enable Accelarators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#steps-for-enabling-gige-camera-with-helm">Steps for Enabling GiGE Camera with helm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-web-visualizer-and-etcdui">Accessing Web Visualizer and EtcdUI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#eii-uninstaller">EII Uninstaller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging">Debugging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#debugging-through-the-logs">Debugging Through the Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-video-ingestion-through-gst-launch">Debugging Video Ingestion Through gst-launch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enablement-of-x11-forwarding-for-eii-visualizer-container">Enablement of X11 Forwarding for EII Visualizer Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-options">Debugging options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#enabling-secure-boot">Enabling Secure boot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release.html#eii-v2-6-new-features">EII v2.6 New Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#known-issues">Known Issues</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">CORE LIBRARIES:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="msgbus.html">EII Message Bus</a><ul>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id1">EII Message Bus</a><ul>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#dependency-installation">Dependency Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#compilation">Compilation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id2">Generating Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#potential-compilation-issues">Potential Compilation Issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#install-python-binding">Install Python Binding</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#install-golang-binding">Install Golang Binding</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#running-unit-tests">Running Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#zeromq-ipc-configuration">ZeroMQ IPC Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#zeromq-tcp-configuration">ZeroMQ TCP Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#additional-zeromq-configuration-properties">Additional ZeroMQ Configuration Properties</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#example-usage">Example Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#c-examples">C Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#python-examples">Python Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#go-examples">Go Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#running-go-examples-without-installing">Running Go Examples without Installing</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#brokered-publish-subscribe">Brokered Publish/Subscribe</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#security">Security</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#using-only-curvezmq-encryption">Using Only CurveZMQ Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id3">Using ZAP Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#disabling-security">Disabling Security</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#known-issues">Known issues</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eiiConfig.html">EII Configuration Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eiiConfig.html#etcd">etcd*</a></li>
<li class="toctree-l2"><a class="reference internal" href="eiiConfig.html#configmgr">ConfigMgr</a></li>
<li class="toctree-l2"><a class="reference internal" href="eiiConfig.html#etcd-ui-service">ETCD UI Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="eiiConfig.html#tool-to-generate-configuration-management-ui-service">Tool to Generate Configuration Management UI Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#adding-new-eii-service-so-it-gets-picked-up-by-builder">Adding new EII service so it gets picked up by Builder</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="eiiConfig.html#id5">ConfigMgr</a><ul>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#install-configmgr-with-python-bindings-go-bindings-examples-test-suits-and-debug-build">Install ConfigMgr with Python bindings, Go bindings, Examples, Test suits and Debug Build.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="eiiConfig.html#interfaces">Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#overriding-of-type-and-endpoint">Overriding of Type and EndPoint:</a></li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#broker-usecase">Broker Usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#zmq-tcp-protocol-usecase">zmq_tcp Protocol usecase</a><ul>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#zmqbroker">ZmqBroker:</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#subscriber">Subscriber</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#publisher">Publisher</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#zmq-ipc-protocol-usecase">zmq_ipc Protocol usecase</a><ul>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#id9">ZmqBroker:</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#id10">Subscriber</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#id11">Publisher</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#note-endpoint-can-be-given-in-different-ways"><strong>Note</strong> “Endpoint” can be given in different ways:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#running-examples">Running Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#id13">CPP Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#id14">Python Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#id15">Go Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#running-unit-tests">Running Unit Tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#c-api">C API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#python-api">Python API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#golang-api">GoLang API</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">VIDEO ANALYTICS PIPELINE:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="video.html">Working with Video Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="video.html#using-video-accelerators-in-ingestion-analytics-containers">Using video accelerators in ingestion/analytics containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#to-run-on-usb-devices"><strong>To run on USB devices</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#to-run-on-myriad-devices"><strong>To run on MYRIAD devices</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#to-run-on-hddl-devices"><strong>To run on HDDL devices</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#videoingestion-module">VideoIngestion Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#ingestor-config">Ingestor config</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#video-ingestion-contents">Video Ingestion Contents</a><ul>
<li class="toctree-l4"><a class="reference internal" href="video.html#camera-configuration">Camera Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="video.html#rtsp-camera">RTSP Camera</a></li>
<li class="toctree-l4"><a class="reference internal" href="video.html#usb-camera">USB Camera</a></li>
<li class="toctree-l4"><a class="reference internal" href="video.html#realsense-depth-camera">RealSense Depth Camera</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#videoanalytics-module">VideoAnalytics Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="video.html#user-defined-function-udf">User Defined Function (UDF)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#dependency-installation">Dependency Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#compilation">Compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#running-unit-tests">Running Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#udf-configuration">UDF Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#sample-udfs">Sample UDFs</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#native-udfs">Native UDFs</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#construction-of-metadata-in-udf">Construction of Metadata in UDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#chaining-of-udfs">Chaining of UDFs</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#combination-of-udfs-with-ingestors">Combination of UDFs with ingestors</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#jupyter-notebook-pre-requisites">Jupyter Notebook pre-requisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#running-jupyter-notebook">Running Jupyter Notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#creating-udf-in-jupyter-notebook">Creating UDF in Jupyter Notebook</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#gigeconfigtool-and-export-settings-from-basler-pylon-feature-system">GigEConfigTool and Export Settings from Basler Pylon Feature System</a></li>
<li class="toctree-l2"><a class="reference internal" href="video.html#discoverhistory">DiscoverHistory</a></li>
<li class="toctree-l2"><a class="reference internal" href="video.html#native-visualizer-module">Native Visualizer Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="video.html#web-visualizer-module">Web Visualizer Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#metadata-structure">Metadata Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#imagestore-module">ImageStore Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#detailed-description-on-each-of-the-keys-used">Detailed description on each of the keys used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#influxdbconnector-module">InfluxDBConnector Module</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">TIME-SERIES ANALYTICS PIPELINE:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="timeseries.html">Working with Timeseries Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#telegraf">Telegraf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#purpose-of-telegraf">Purpose of Telegraf</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#optional-adding-multiple-telegraf-instances">Optional: Adding multiple telegraf instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#enabling-eii-message-bus-input-plugin-in-telegraf">Enabling EII message bus input plugin in Telegraf</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#enabling-eii-message-bus-output-plugin-in-telegraf">Enabling EII message bus Output plugin in Telegraf</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#advanced-multiple-plugin-sections-of-eii-message-bus-input-plugin">Advanced: Multiple plugin sections of EII message bus input plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#advanced-multiple-plugin-sections-of-eii-message-bus-output-plugin">Advanced: Multiple plugin sections of EII message bus output plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#kapacitor">Kapacitor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#starting-the-example">Starting the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#purpose-of-kapacitor">Purpose of Kapacitor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#kapacitor-input-and-output-plugins">Kapacitor input and output plugins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#purpose-of-plugins">Purpose of plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#using-input-plugin">Using input plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#using-output-plugin">Using output plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#user-defined-functions">User-defined Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#custom-udfs-available-in-the-udfs-directory">Custom UDFs available in the udfs directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#steps-to-configure-the-udfs-in-kapacitor">Steps to configure the UDFs in kapacitor.</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#interfaces-exposed-for-udfs">Interfaces Exposed for UDFs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#id48">Introduction to samples of multiple UDFs in a single task and multiple tasks with single UDF</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#id49">Steps to run the samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#id65">Steps to verify the results in single task with multiple UDFs</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#id66">Steps to verify the results in multiple tasks with single UDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#working-with-kapacitor">Working with Kapacitor*</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#influxdb">InfluxDB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#configuring-influxdb">Configuring InfluxDB*</a><ul>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#influxdbconnector-module">InfluxDBConnector Module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#influxdbconnector-configuration">InfluxDBConnector Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#influxdbconnector-installation">InfluxDBConnector Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#eii-timeseriesprofiler">EII TimeSeriesProfiler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#eii-pre-requisites">EII pre-requisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#eii-timeseriesprofiler-modes">EII TimeSeriesProfiler modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#running-timeseriesprofiler">Running TimeSeriesProfiler</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">EXPORT SERVICES:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="azure.html">Azure Bridge</a><ul>
<li class="toctree-l2"><a class="reference internal" href="azure.html#pre-requisites-setup">Pre-Requisites / Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="azure.html#azure-cloud-setup">Azure Cloud Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="azure.html#id1">Setting up AzureML</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#development-system-setup">Development System Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="azure.html#build-and-push-eii-containers">Build and Push EII Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure.html#id2">Single-Node Azure IoT Edge Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="azure.html#step-1-provisioning">Step 1 - Provisioning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="azure.html#expected-result">Expected Result</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#step-2-configuring-eii">Step 2 - Configuring EII</a><ul>
<li class="toctree-l4"><a class="reference internal" href="azure.html#id7">Expected Result</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#step-3-configuring-azure-iot-deployment-manifest">Step 3 - Configuring Azure IoT Deployment Manifest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="azure.html#id9">Expected Result</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#step-4-deployment">Step 4 - Deployment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="azure.html#expected-results">Expected Results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#helpful-debugging-commands">Helpful Debugging Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#final-notes">Final Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="azure.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="azure.html#id11">Azure Bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#id14">Sample EII ONNX UDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#simple-subscriber">Simple Subscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#eii-etcd-pre-load">EII ETCD Pre-Load</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#azure-blob-storage">Azure Blob Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure.html#azure-deployment-manifest">Azure Deployment Manifest</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="azure.html#azure-iot-edge-simulator">Azure IoT Edge Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure.html#id22">Supported EII Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure.html#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="opcua.html">OpcuaExport Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="opcua.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="opcua.html#service-bring-up">Service bring up</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="restdata.html">RestDataExport</a><ul>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#restexport-post-request-pipeline">RestExport POST Request Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#restexport-get-request-pipeline">RestExport Get Request Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#restexport-apis">RestExport APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#restexport-post-request-api">RestExport POST Request API</a></li>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#restexport-get-request-api">RestExport GET Request API</a></li>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="restdata.html#pre-requisites">Pre-requisites</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#service-bring-up">Service bring up</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">ADDITIONAL INFO:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools.html">EII Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tools.html#time-series-benchmarking-tool">Time Series Benchmarking Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#video-benchmarking-tool">Video Benchmarking Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#discoverhistory">DiscoverHistory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#steps-to-build-and-run-discoverhistory-service">Steps to build and run DiscoverHistory service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#list-of-sample-select-queries">List of sample select queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#to-run-the-tool-in-zmq-ipc-mode">To run the tool in zmq_ipc mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#embpublisher">EmbPublisher</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id16">How to integrate this tool with video/timeseries use case.</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id17">Configuration of the tool.</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id18">Running EmbPublisher in IPC mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#id22">EmbSubscriber</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id23">EII pre-requisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id26">Running EmbSubscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id27">Running EmbSubscriber in IPC mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#id31">EII GigEConfig tool</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id32">Generating PFS(Pylon Feature Stream) File</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id33">Running GigEConfig Tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools.html#id34">Usage of GigEConfig tool:</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#id36">Execution of GigEConfig</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#httptestserver">HttpTestServer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#pre-requisites-for-running-the-httptestserver">Pre-requisites for running the HttpTestServer</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#starting-httptestserver">Starting HttpTestServer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#id39">Jupyter Notebook usage to develop python UDFs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id40">Jupyter Notebook pre-requisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id45">Running Jupyter Notebook</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#id48">MQTT publisher</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id49">Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#id51">Software Trigger Utility for VideoIngestion Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id52">Software Trigger Utilily pre-requisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id56">Configuration file:</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id59">Running Software Trigger Utility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#id62">EII TimeSeriesProfiler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id63">EII pre-requisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id66">EII TimeSeriesProfiler modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id70">EII TimeSeriesProfiler configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id71">Running TimeSeriesProfiler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#id91">EII Video Profiler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id92">EII Video Profiler pre-requisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id95">EII Video Profiler modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id100">EII Video Profiler configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id103">Running Video Profiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id111">Optimizing EII Video pipeline by analysing Video Profiler results</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id113">Benchmarking with multi instance config</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sample.html">EII Samples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sample.html#steps-to-run-eii-samples-apps">Steps to run EII samples apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="sample.html#sample-cpp-app-for-eii-platform">Sample CPP APP for EII platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sample.html#short-description-of-app-containers">‘Short Description of App containers’</a></li>
<li class="toctree-l3"><a class="reference internal" href="sample.html#the-sample-golang-application-demonstrates-the-usage-of-eii-core-libraries-like-eiimessagebus-and-configmanager">The sample Golang application demonstrates the usage of EII core libraries like EIIMessageBus and ConfigManager</a></li>
<li class="toctree-l3"><a class="reference internal" href="sample.html#id3">Short Description of App containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="sample.html#the-high-level-logical-flow-of-sample-app-is-as-below">The high level logical flow of Sample App is as below:</a></li>
<li class="toctree-l3"><a class="reference internal" href="sample.html#sample-python-app-for-eii-platform">Sample Python APP for EII platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="sample.html#id4">Short Description of App containers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="security.html#provisioning">Provisioning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="security.html#generating-keys-and-certificates">Generating Keys and Certificates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="security.html#start-up-and-run-time">Start Up and Run Time</a><ul>
<li class="toctree-l3"><a class="reference internal" href="security.html#accessing-secrets">Accessing Secrets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="security.html#certificate-revocation">Certificate Revocation</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EII Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Running Intel® Edge Insights for Industrial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/pages/running.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="running-intel-edge-insights-for-industrial">
<h1>Running Intel® Edge Insights for Industrial<a class="headerlink" href="#running-intel-edge-insights-for-industrial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="minimum-system-requirements">
<h2>Minimum System Requirements<a class="headerlink" href="#minimum-system-requirements" title="Permalink to this headline">¶</a></h2>
<p>EII software will run on the below mentioned Intel platforms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>* 6th generation Intel® CoreTM processor onwards OR
  6th generation Intel® Xeon® processor onwards OR
  Pentium® processor N4200/5, N3350/5, N3450/5 with Intel® HD Graphics
* At least 16GB RAM
* At least 64GB hard drive
* An internet connection
* Ubuntu 18.04 / Ubuntu 20.04
</pre></div>
</div>
<p>For performing Video Analytics, a 16GB of RAM is recommended.
For time-series ingestion and analytics, a 2GB RAM is sufficient.
The EII is validated on Ubuntu 18.04 and though it can run on other platforms supporting docker, it is not recommended.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If running the EII device behind a HTTP proxy server, you will need to configure the proxy. It is recommended that you consult Docker’s instructions, which can be found at: <a class="reference external" href="https://docs.docker.com/network/proxy/">https://docs.docker.com/network/proxy/</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the user that running behind a corporate proxy, you will need to setup the proxy for the host system in the /etc/environment file before proceeding to the installation step.</p>
</div>
</div>
<div class="section" id="downloading-and-installation-from-opensource-github-repository">
<h2>Downloading and Installation from Opensource Github Repository<a class="headerlink" href="#downloading-and-installation-from-opensource-github-repository" title="Permalink to this headline">¶</a></h2>
<p>For EII opensource download directly from Github repository, users can browse to this <a class="reference external" href="https://github.com/open-edge-insights/eii-manifests">link</a> to access GitHub and follow through the step by step guide from <a class="reference external" href="https://github.com/open-edge-insights/eii-manifests/blob/master/README.md">README</a> in EII Manifests to download all applicable EII repos.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/fig4.2.png"><img alt="../_images/fig4.2.png" src="../_images/fig4.2.png" style="width: 997.0px; height: 187.0px;" /></a>
</div>
</div>
<div class="section" id="eii-prerequisites-installation">
<h2>EII Prerequisites installation<a class="headerlink" href="#eii-prerequisites-installation" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Recommended <code class="docutils literal notranslate"><span class="pre">Docker</span> <span class="pre">CLI</span> <span class="pre">&amp;</span> <span class="pre">Daemon</span> <span class="pre">version</span></code> is <code class="docutils literal notranslate"><span class="pre">20.10.6</span></code></p></li>
<li><p>Recommended <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">version</span></code> is <code class="docutils literal notranslate"><span class="pre">1.29.0</span></code></p></li>
</ul>
</div>
<p>The script automates the installation &amp; configuration of all the prerequisite software needed to be installed on a system with a freshly installed operating system to make the system ready for provisioning, building and running EII stack. These pre-requisite softwares include:</p>
<ol class="arabic simple">
<li><p><strong>docker daemon</strong></p></li>
<li><p><strong>docker client</strong></p></li>
<li><p><strong>docker-compose</strong></p></li>
<li><p><strong>Python packages</strong></p></li>
</ol>
<p>The script checks if docker &amp; docker-compose are already installed in the system. If not installed, then it installs the intended version of the docker &amp; docker-compose which is mentioned in the script.
If docker and/or docker-compose are already installed in the system but the installed version of the docker/docker-compose is older than the intended docker/docker-compose version (which is mentioned in the script) then the script uninstalls the older version of docker/docker-compose &amp; re-installs the intended version mentioned in the script. The script also configures the proxy settings for docker client and docker daemon to connect to internet.</p>
<p>The <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/pre_requisites.sh">build/pre_requisites.sh</a> script also does proxy setting configuration for both system wide proxy &amp; docker proxy. The script prompts for the proxy address to be entered by the user, if the system is behind a proxy.
The script also configures proxy setting system wide <code class="docutils literal notranslate"><span class="pre">/etc/environment</span></code> and for docker by taking the proxy value as user input if the system is running behind proxy. The proxy settings for <code class="docutils literal notranslate"><span class="pre">/etc/apt/apt.conf</span></code> is also set by this script to enable apt updates &amp; installations.</p>
<hr class="docutils" />
<p><strong>Note</strong>:</p>
<ul>
<li><p>It is recommended to install the required <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">version</span></code>
which is <code class="docutils literal notranslate"><span class="pre">1.29.0</span></code>. Older version of docker-compose binary less than 1.29.0 may not work with the video-usecase docker-compose.yml files. It is observed that <code class="docutils literal notranslate"><span class="pre">device_cgroup_rules</span></code> command is not supported in certain docker-compose binaries versions less than <code class="docutils literal notranslate"><span class="pre">1.29.0</span></code>.</p></li>
<li><p>If one still needs to use the older versions of docker-compose then
<code class="docutils literal notranslate"><span class="pre">device_cgroup_rules</span></code> command needs to be commented in <code class="docutils literal notranslate"><span class="pre">ia_video_ingestion</span></code> and <code class="docutils literal notranslate"><span class="pre">ia_video_analytics</span></code> service which could result in limited inference and device support.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span>       <span class="l l-Scalar l-Scalar-Plain">ia_video_ingestion</span><span class="p p-Indicator">:</span>
         <span class="l l-Scalar l-Scalar-Plain">...</span>
         <span class="l l-Scalar l-Scalar-Plain">#device_cgroup_rules</span><span class="p p-Indicator">:</span>
           <span class="c1">#- &#39;c 189:* rmw&#39;</span>
           <span class="c1">#- &#39;c 209:* rmw&#39;</span>

<span class="l l-Scalar l-Scalar-Plain">After making changes to the docker-compose.yml file refer ``Using builder script`` section to re-run ``builder.py`` script before running the services using ``docker-compose up``</span>
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
<ol class="arabic simple">
<li><p><strong>Steps to run the pre-requisites script is as follows</strong>:</p></li>
</ol>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">[</span>WORKDIR<span class="o">]</span>/IEdgeInsights/build
$ sudo -E ./pre_requisites.sh --help

Usage :: sudo -E ./pre_requisites.sh <span class="o">[</span>OPTION...<span class="o">]</span>

List of available options...

--proxy         proxies, required when the gateway/edge node running EII <span class="o">(</span>or any of EII profile<span class="o">)</span> is connected behind proxy

--help / -h         display this <span class="nb">help</span> and <span class="nb">exit</span>

Note : If --proxy option is not provided <span class="k">then</span> script will run without proxy

Different use cases...

                <span class="m">1</span>. RUNS WITHOUT PROXY
                <span class="nv">$sudo</span> -E ./pre_requisites.sh


                <span class="m">2</span>.RUNS WITH PROXY
                <span class="nv">$sudo</span> -E ./pre_requisites.sh --proxy<span class="o">=</span><span class="s2">&quot;proxy.intel.com:891&quot;</span>
</pre></div>
</div>
<ol class="arabic">
<li><p><strong>Optional:</strong> For enabling full security for production deployments, make sure host machine and docker daemon are configured with below security recommendations. <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/docker_security_recommendation.md">build/docker_security_recommendation.md</a></p></li>
<li><p><strong>Optional:</strong> If one wishes to enable log rotation for docker containers</p>
<blockquote>
<div><p>There are two ways to configure logging driver for docker containers</p>
</div></blockquote>
<ul>
<li><p>Set logging driver as part of docker daemon (<strong>applies to all docker containers by default</strong>):</p>
<ul>
<li><p>Configure <code class="docutils literal notranslate"><span class="pre">json-file</span></code> driver as default logging driver by following <a class="reference external" href="https://docs.docker.com/config/containers/logging/json-file/">https://docs.docker.com/config/containers/logging/json-file/</a>. Sample json-driver config which can be copied to <code class="docutils literal notranslate"><span class="pre">/etc/docker/daemon.json</span></code> is provided below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;log-driver&quot;</span><span class="p">:</span> <span class="s2">&quot;json-file&quot;</span><span class="p">,</span>
    <span class="s2">&quot;log-opts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;max-size&quot;</span><span class="p">:</span> <span class="s2">&quot;10m&quot;</span><span class="p">,</span>
    <span class="s2">&quot;max-file&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Reload the docker daemon</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo systemctl daemon-reload
</pre></div>
</div>
</li>
<li><p>Restart docker
.. code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo systemctl restart docker
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Set logging driver as part of docker compose which is conatiner specific and which always overwrites 1st option (i.e /etc/docker/daemon.json)</p>
<blockquote>
<div><p>Example to enable logging driver only for video_ingestion service:</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ia_video_ingestion</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="o">...</span>
    <span class="n">logging</span><span class="p">:</span>
     <span class="n">driver</span><span class="p">:</span> <span class="n">json</span><span class="o">-</span><span class="n">file</span>
     <span class="n">options</span><span class="p">:</span>
      <span class="nb">max</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">10</span><span class="n">m</span>
      <span class="nb">max</span><span class="o">-</span><span class="n">file</span><span class="p">:</span> <span class="mi">5</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="generate-deployment-and-configuration-files">
<h2>Generate deployment and configuration files<a class="headerlink" href="#generate-deployment-and-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>The section assumes the EII software is already downloaded from the release package or from git.
Run all the below commands in this section from <code class="docutils literal notranslate"><span class="pre">[WORKDIR]/IEdgeInsights/build/</span></code> directory.</p>
<div class="section" id="generating-consolidated-docker-compose-yml-and-eii-config-json-files">
<h3>Generating consolidated docker-compose.yml and eii_config.json files:<a class="headerlink" href="#generating-consolidated-docker-compose-yml-and-eii-config-json-files" title="Permalink to this headline">¶</a></h3>
<p>EII is equipped with <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/builder.py">builder</a>, a robust python tool to auto-generate the required configuration files to deploy EII services on single/multiple nodes. The tool is    capable of auto-generating the following consolidated files by fetching the respective files from EII service directories which are required to bring up different EII use-cases:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>file name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>docker-compose.yml</p></td>
<td><p>Consolidated <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file used to launch EII docker containers in a given single node using <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> tool</p></td>
</tr>
<tr class="row-odd"><td><p>docker-compose.override.yml</p></td>
<td><p>Consolidated <code class="docutils literal notranslate"><span class="pre">docker-compose-dev.override.yml</span></code> of every app that is generated only in DEV mode for EII deployment on a given single node using <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> tool</p></td>
</tr>
<tr class="row-even"><td><p>docker-compose-build.yml</p></td>
<td><p>Consolidated <code class="docutils literal notranslate"><span class="pre">docker-compose-build.yml</span></code> file having EII base images and <code class="docutils literal notranslate"><span class="pre">depends_on</span></code> and <code class="docutils literal notranslate"><span class="pre">build</span></code> keys required for building EII services</p></td>
</tr>
<tr class="row-odd"><td><p>docker-compose-push.yml</p></td>
<td><p>Consolidated <code class="docutils literal notranslate"><span class="pre">docker-compose-push.yml</span></code> file (same as <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file with just dummy <code class="docutils literal notranslate"><span class="pre">build</span></code> key added), used for pushing EII services to docker registry</p></td>
</tr>
<tr class="row-even"><td><p>eii_config.json</p></td>
<td><p>Consolidated <code class="docutils literal notranslate"><span class="pre">config.json</span></code> of every app which will be put into etcd during provisioning</p></td>
</tr>
<tr class="row-odd"><td><p>values.yaml</p></td>
<td><p>Consolidated <code class="docutils literal notranslate"><span class="pre">values.yaml</span></code> of every app inside helm-eii/eii-deploy directory, which is required to deploy EII services via helm</p></td>
</tr>
<tr class="row-even"><td><p>Template yaml files</p></td>
<td><p>Files copied from helm/templates directory of every app to helm-eii/eii-deploy/templates directory, which are required to deploy EII services via helm</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Whenever we make changes to individual EII app/service directories files as mentioned above in the description column</dt><dd><p>or in the <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/.env">build/.env</a> file, it is required to re-run the <code class="docutils literal notranslate"><span class="pre">builder.py</span></code> script before provisioning and running
the EII stack to ensure that the changes done reflect in the required consolidated files.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Manual editing of above consolidated files is not recommended and we would recommend to do the required changes to</dt><dd><p>respective files in EII app/service directories and use <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/builder.py">build/builder.py</a> script to generate the conslidated ones.</p>
</dd>
</dl>
</li>
</ol>
</div>
</div>
<div class="section" id="using-builder-script">
<h3>Using builder script<a class="headerlink" href="#using-builder-script" title="Permalink to this headline">¶</a></h3>
<p>Builder script usage:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ python3 builder.py -h
usage: builder.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-f YML_FILE<span class="o">]</span> <span class="o">[</span>-v VIDEO_PIPELINE_INSTANCES<span class="o">]</span>
                    <span class="o">[</span>-d OVERRIDE_DIRECTORY<span class="o">]</span>

optional arguments:
    -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
    -f YML_FILE, --yml_file YML_FILE
                        Optional config file <span class="k">for</span> list of services to include.
                        Eg: python3 builder.py -f video-streaming.yml
                        <span class="o">(</span>default: None<span class="o">)</span>
    -v VIDEO_PIPELINE_INSTANCES, --video_pipeline_instances VIDEO_PIPELINE_INSTANCES
                        Optional number of video pipeline instances to be
                        created. Eg: python3 builder.py -v <span class="m">6</span> <span class="o">(</span>default:
                        <span class="m">1</span><span class="o">)</span>
    -d OVERRIDE_DIRECTORY, --override_directory OVERRIDE_DIRECTORY
                        Optional directory consisting of of benchmarking
                        configs to be present in each app directory. Eg:
                        python3 builder.py -d benchmarking <span class="o">(</span>default:
                        None<span class="o">)</span>
</pre></div>
</div>
<div class="section" id="running-builder-to-generate-the-above-listed-consolidated-files-for-all-applicable-eii-services">
<h4>Running builder to generate the above listed consolidated files for all applicable EII services<a class="headerlink" href="#running-builder-to-generate-the-above-listed-consolidated-files-for-all-applicable-eii-services" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Builder will parse the top level directories under <strong>IEdgeInsights</strong> to generate the above listed consolidated files.</p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ python3 builder.py
</pre></div>
</div>
</div>
<div class="section" id="running-builder-to-generate-the-above-listed-consolidated-files-for-a-subset-of-eii-services">
<h4>Running builder to generate the above listed consolidated files for a subset of EII services:<a class="headerlink" href="#running-builder-to-generate-the-above-listed-consolidated-files-for-a-subset-of-eii-services" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>This is achieved by providing a yml file to Builder as config which has list of services to include. User can mention the service name as path relative to <strong>IEdgeInsights</strong> or Full path to the service in the config yml file.</p>
<p>If user wants to include only a certain number of services in the EII stack, he can opt to provide the <strong>-f or yml_file</strong> flag of builder.py to allow only the services provided in the yml file mentioned with the <strong>-f or yml_file</strong>. Few examples of such yml files for different usecases are provided at <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/video-streaming-azure.yml">Azure</a>, <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/video-streaming-azure.yml">Azure</a>, <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/video-streaming-azure.yml">Azure</a> etc.,</p>
<p>An example for running Builder with this flag is given below:</p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ python3 builder.py -f usecases/video-streaming.yml
</pre></div>
</div>
<hr class="docutils" />
<p><strong>NOTE</strong>:</p>
<ul>
<li><p><strong>Main usecases</strong>:
| Usecase                    | yaml file                                                |
| :—                       | :—                                                    |
| Video + Timeseries         | <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/video-timeseries.yml">build/usecases/video-timeseries.yml</a> |
| Video                      | <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/video.yml">build/usecases/video.yml</a>                       |
| Timeseries                 | <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/time-series.yml">build/usecases/time-series.yml</a>           |</p></li>
<li><p><strong>Video pipeline sub-usecases</strong>:</p>
<div class="line-block">
<div class="line">Usecase                                | yaml file                                                               |</div>
<div class="line">:—                                   | :—                                                                    |</div>
<div class="line">Video streaming                        | <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/video-streaming.yml">build/usecases/video-streaming.yml</a>                  |</div>
<div class="line">Video streaming and historical         | <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/video-streaming-storage.yml">build/usecases/video-streaming-storage.yml</a>  |</div>
<div class="line">Video streaming with AzureBridge       | <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/video-streaming-azure.yml">build/usecases/video-streaming-azure.yml</a>      |</div>
<div class="line">Video streaming and custom udfs        | <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/usecases/video-streaming-all-udfs.yml">build/usecases/video-streaming-all-udfs.yml</a>|</div>
</div>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="running-builder-to-generate-multi-instance-configs">
<h4>Running builder to generate multi instance configs:<a class="headerlink" href="#running-builder-to-generate-multi-instance-configs" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Based on the user’s requirements, builder can also generate multi-instance docker-compose.yml, config.json respectively.</p>
<p>If user wants to generate boiler plate config for multiple stream use cases, he can do so by using the <strong>-v or video_pipeline_instances</strong> flag of builder. This flag creates multi stream boiler plate config for docker-compose.yml, eii_config.json files respectively.</p>
<p>An example for running builder to generate multi instance boiler plate config for 3 streams of <strong>video-streaming</strong> use case has been provided below:</p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ python3 builder.py -v <span class="m">3</span> -f usecases/video-streaming.yml
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This multi-instance feature support of Builder works only for the video pipeline i.e., <strong>usecases/video-streaming.yml</strong> use case alone and not with any other use case yml files like <strong>usecases/video-streaming-storage.yml</strong> etc., Also, it doesn’t work for cases without <code class="docutils literal notranslate"><span class="pre">-f</span></code> switch too. In other words, only the above example works with <code class="docutils literal notranslate"><span class="pre">-v</span></code> taking in any +ve number</p>
</div>
</div>
<div class="section" id="running-builder-to-generate-benchmarking-configs">
<h4>Running builder to generate benchmarking configs:<a class="headerlink" href="#running-builder-to-generate-benchmarking-configs" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>If user wants to provide a different set of docker-compose.yml, config.json other than the ones present in every service directory, he can opt to provide the <strong>-d or override_directory</strong> flag which indicates to search for these required set of files within a directory provided by the flag. For example, if user wants to pick up these files from a directory named <strong>benchmarking</strong>, he can run the command provided below:</p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ python3 builder.py -d benchmarking
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If using the override directory feature of builder, it is recommended to include set of all 3 files mentioned above. Failing to provide any of the files in the override directory results in builder not including that service in the generated final config.</p></li>
<li><p>If user wishes to spawn a single Subscriber/Client container subscribing/receiving on multiple Publisher/Server containers, he can do so by adding the AppName of Subscriber/Client container in <strong>subscriber_list</strong> of <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/builder_config.json">builder_config.json</a> ensuring the Publisher/Server container <strong>AppName</strong> is added in the <strong>publisher_list</strong> of <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/builder_config.json">builder_config.json</a>. For services not mentioned in <strong>subscriber_list</strong>, multiple containers specified by the <strong>-v</strong> flag are spawned.
For eg: If builder is run with <strong>-v 3</strong> option and <strong>Visualizer</strong> isn’t added in <strong>subscriber_list</strong> of <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/builder_config.json">builder_config.json</a>, 3 <strong>Visualizer</strong> instances are spawned, each of them subscribing to 3 <strong>VideoAnalytics</strong> services. If <strong>Visualizer</strong> is added in <strong>subscriber_list</strong> of <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/builder_config.json">builder_config.json</a>, a single <strong>Visualizer</strong> instance subscribing to 3 multiple <strong>VideoAnalytics</strong> is spawned.</p></li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="provision">
<h2>Provision<a class="headerlink" href="#provision" title="Permalink to this headline">¶</a></h2>
<p><span class="raw-html-m2r"><b>By default EII is provisioned in Secure mode</b></span>.</p>
<p>Follow below steps to provision. Provisioning must be done before deploying EII on any node. It will start ETCD as a container and load it with configuration required to run EII for single node or multi node cluster set up.</p>
<p>Please follow below steps to provision in Developer mode. Developer mode will have all security disabled.</p>
<ul class="simple">
<li><p>Please update DEV_MODE=true in <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/.env">build/.env</a> to provision in Developer mode.</p></li>
<li><p>Please re-run the <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/builder.py">build/builder.py</a> to re-generate the consolidated files as mentioned above</p></li>
</ul>
<p>Following actions will be performed as part of Provisioning</p>
<ul class="simple">
<li><p>Loading initial ETCD values from json file located at <code class="docutils literal notranslate"><span class="pre">build/provision/config/eii_config.json</span></code>.</p></li>
<li><p>For Secure mode only, Generating ZMQ secret/public keys for each app and putting them in ETCD.</p></li>
<li><p>Generating required X509 certs and putting them in etcd.</p></li>
<li><p>All server certificates will be generated with 127.0.0.1, localhost and HOST_IP mentioned in <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/.env">build/.env</a>.</p></li>
<li><p>If HOST_IP is blank in <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/.env">build/.env</a>, then HOST_IP will be automatically detected when server certificates are generated.</p></li>
</ul>
<p><strong>Optional:</strong> In case of any errors during provisioning w.r.t existing volumes, please remove the existing volumes by running the EII uninstaller script: <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/eii_uninstaller.sh">eii_uninstaller.sh</a></p>
<p>Run all the below commands in this section from <code class="docutils literal notranslate"><span class="pre">[WORKDIR]/IEdgeInsights/build/provision</span></code> directory.</p>
<p>Below script starts <code class="docutils literal notranslate"><span class="pre">etcd</span></code> as a container and provision. Please pass docker-compose file as argument, against which provisioning will be done.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">[</span>WORKDIR<span class="o">]</span>/IEdgeInsights/build/provision
$ sudo -E ./provision.sh &lt;path_to_eii_docker_compose_file&gt;

$ <span class="c1"># eq. $ sudo -E ./provision.sh ../docker-compose.yml</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Optional</strong>: By default, the provisioning step will pull the provisioning images from docker registry. In case the user wants to build the images, <code class="docutils literal notranslate"><span class="pre">--build</span></code> flag should be provided in the provisioning command i.e.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ sudo -E ./provision.sh &lt;path_to_eii_docker_compose_file&gt; --build
$ <span class="c1"># eq. $ sudo -E ./provision.sh ../docker-compose.yml --build</span>
</pre></div>
</div>
<p><strong>Note</strong>
The above command only <code class="docutils literal notranslate"><span class="pre">build</span></code> the provisioining images, will not do any other functions of provisioning script.</p>
</div></blockquote>
<p><strong>Optional:</strong> For capturing the data back from Etcd to a JSON file, run the <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/provision/etcd_capture.sh">etcd_capture.sh</a> script. This can be achieved using the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ./etcd_capture.sh
</pre></div>
</div>
</div>
<div class="section" id="distribution-of-eii-container-images">
<h2>Distribution of EII container images<a class="headerlink" href="#distribution-of-eii-container-images" title="Permalink to this headline">¶</a></h2>
<p>EII services are available as pre-built container images in docker hub at <a class="reference external" href="https://hub.docker.com/u/openedgeinsights">https://hub.docker.com/u/openedgeinsights</a></p>
<p>and for the ones not listed there, one needs to do the build from source before running <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span> <span class="pre">-d</span></code> command.</p>
<p>Eg:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">[</span>WORKDIR<span class="o">]</span>/IEdgeInsights/build
$ <span class="c1"># Base images that needs to be built</span>
$ docker-compose -f docker-compose-build.yml build ia_eiibase
$ docker-compose -f docker-compose-build.yml build ia_common
$ <span class="c1"># Assuming here that the `python3 builder.py` step is been executed and ia_kapacitor</span>
$ <span class="c1"># service exists in the generated compose files and also, provisioning step is done</span>
$ docker-compose -f docker-compose-build.yml build ia_kapacitor
$ docker-compose up -d
</pre></div>
</div>
<p>Below are the list of pre-built container images that are accessible at <a class="reference external" href="https://hub.docker.com/u/openedgeinsights">https://hub.docker.com/u/openedgeinsights</a>:</p>
<ol class="arabic simple">
<li><p><strong>Provisioning images</strong></p>
<ul class="simple">
<li><p>openedgeinsights/ia_etcd_provision</p></li>
<li><p>openedgeinsights/ia_etcd</p></li>
</ul>
</li>
<li><p><strong>Common EII images applicable for video and timeseries use cases</strong></p>
<ul class="simple">
<li><p>openedgeinsights/ia_etcd_ui</p></li>
<li><p>openedgeinsights/ia_influxdbconnector</p></li>
<li><p>openedgeinsights/ia_rest_export</p></li>
<li><p>openedgeinsights/ia_opcua_export</p></li>
</ul>
</li>
<li><p><strong>Video pipeline images</strong></p>
<ul class="simple">
<li><p>openedgeinsights/ia_video_ingestion</p></li>
<li><p>openedgeinsights/ia_video_analytics</p></li>
<li><p>openedgeinsights/ia_web_visualizer</p></li>
<li><p>openedgeinsights/ia_visualizer</p></li>
<li><p>openedgeinsights/ia_imagestore</p></li>
<li><p>openedgeinsights/ia_azure_bridge</p></li>
<li><p>openedgeinsights/ia_azure_simple_subscriber</p></li>
</ul>
</li>
<li><p><strong>Timeseries pipeline images</strong></p>
<ul class="simple">
<li><p>openedgeinsights/ia_grafana</p></li>
</ul>
</li>
</ol>
<p>Additionally, we have <code class="docutils literal notranslate"><span class="pre">openedgeinsights/ia_edgeinsights_src</span></code> image available at the above docker hub
location which consists of source code of GPL/LGPL/AGPL components of EII stack.</p>
</div>
<div class="section" id="list-of-all-eii-services">
<h2>List of All EII Services<a class="headerlink" href="#list-of-all-eii-services" title="Permalink to this headline">¶</a></h2>
<p>EII stack comes with following services, which can be included/excluded in docker-compose file based on requirements.</p>
<div class="section" id="common-eii-services">
<h3>Common EII services<a class="headerlink" href="#common-eii-services" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/open-edge-insights/eii-etcd-ui/blob/master/README.md">EtcdUI</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/eii-influxdb-connector/blob/master/README.md">InfluxDBConnector</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/eii-opcua-export/blob/master/README.md">OpcuaExport</a> - Optional service to read from VideoAnalytics container to publish data to opcua clients</p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/eii-rest-data-export/blob/master/README.md">RestDataExport</a> - Optional service to read the metadata and image blob from InfluxDBConnector and ImageStore services respectively</p></li>
</ol>
</div>
<div class="section" id="video-related-services">
<h3>Video related services<a class="headerlink" href="#video-related-services" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/open-edge-insights/video-ingestion/blob/master/README.md">VideoIngestion</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/video-analytics/blob/master/README.md">VideoAnalytics</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/video-native-visualizer/blob/master/README.md">Visualizer</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/video-web-visualizer/blob/master/README.md">WebVisualizer</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/video-imagestore/blob/master/README.md">ImageStore</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/eii-azure-bridge/blob/master/README.md">AzureBridge</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/eii-factoryctrl/blob/master/README.md">FactoryControlApp</a> - Optional service to read from VideoAnalytics container if one wants to control the light based on defective/non-defective data</p></li>
</ol>
</div>
<div class="section" id="timeseries-related-services">
<h3>Timeseries related services<a class="headerlink" href="#timeseries-related-services" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/open-edge-insights/ts-telegraf/blob/master/README.md">Telegraf</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/ts-kapacitor/blob/master/README.md">Kapacitor</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/ts-grafana/blob/master/README.md">Grafana</a></p></li>
<li><p><a class="reference external" href="https://github.com/open-edge-insights/eii-zmq-broker/blob/master/README.md">ZMQ Broker</a></p></li>
</ol>
</div>
</div>
<div class="section" id="dev-mode-and-profiling-mode">
<h2>Dev mode and Profiling mode<a class="headerlink" href="#dev-mode-and-profiling-mode" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dev-mode">
<h3>Dev Mode<a class="headerlink" href="#dev-mode" title="Permalink to this headline">¶</a></h3>
<p>Starting the EII in Dev ModeDev mode eases the development phase for System Integrator (SI). This mode can be enabled by setting the environment variable dev_mode to <strong>true</strong> in the <strong>[WORK_DIR]/IEdgeInsights/build/.env</strong> file. The default value of this variable is <strong>false</strong>.</p>
</div>
<div class="section" id="starting-the-eii-in-dev-mode">
<h3>Starting the EII in Dev Mode<a class="headerlink" href="#starting-the-eii-in-dev-mode" title="Permalink to this headline">¶</a></h3>
<p>All components will communicate over non-encrypted channels in dev mode.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The user should not use this mode in a production environment because the security features have been disabled in this mode.</p>
</div>
</div>
<div class="section" id="profiling-mode">
<h3>Profiling Mode<a class="headerlink" href="#profiling-mode" title="Permalink to this headline">¶</a></h3>
<p>Profiling mode is used to gather performance statistics. In this mode, each EII component makes a record of the time needed for processing any single frame. These statistics are gathered in the visualizer where the SI can see the end-to-end processing time for individual frames, as well as the end-to-end average time. To enable profiling mode in EII, set the environment variable <strong>PROFILING</strong> in the <strong>[WORK_DIR]/IEdgeInsights/build/.env</strong> file to <strong>true</strong>.</p>
<p>For each EII services defined in the <strong>[WORK_DIR]/IEdgeInsights/build/docker-compose.yml</strong> file, there is an ENV to determine whether <strong>PROFILING</strong> should be enabled based on the setting in the <strong>[WORK_DIR]/IEdgeInsights/build/.env</strong> file. Figure 52 provides an example from the Visualizer service.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/profiling-mode.png"><img alt="../_images/profiling-mode.png" src="../_images/profiling-mode.png" style="width: 347.0px; height: 318.0px;" /></a>
</div>
</div>
</div>
<div class="section" id="build-and-run-eii-video-timeseries-use-cases">
<h2>Build and Run EII video/timeseries use cases<a class="headerlink" href="#build-and-run-eii-video-timeseries-use-cases" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><dl class="simple">
<dt>For running EII services in IPC mode, make sure that the same user should be there in publisher and subscriber.</dt><dd><p>If publisher is running as root (eg: VI, VA), then the subscriber also need to run as root.
In <code class="docutils literal notranslate"><span class="pre">build/docker-compose.yml</span></code> if <code class="docutils literal notranslate"><span class="pre">user:</span> <span class="pre">${EII_UID}</span></code> is in publisher service, then the
same <code class="docutils literal notranslate"><span class="pre">user:</span> <span class="pre">${EII_UID}</span></code> has to be in subscriber service. If the publisher doesn’t have the user specified like above,
then the subscriber service should not have that too.</p>
</dd>
</dl>
</li>
<li><p>If services needs to be running in multiple nodes in TCP mode of communication, msgbus subscribers and clients of <code class="docutils literal notranslate"><span class="pre">AppName</span></code> are required to configure the “EndPoint” in config.json with HOST_IP and PORT under “Subscribers/Publishers” or “Clients/Servers” interfaces section.</p></li>
<li><dl class="simple">
<dt>Make sure the PORT is being exposed in <code class="docutils literal notranslate"><span class="pre">build/docker-compose.yml</span></code> of the respective <code class="docutils literal notranslate"><span class="pre">AppName</span></code></dt><dd><p>Eg: If the <code class="docutils literal notranslate"><span class="pre">&quot;EndPoint&quot;:</span> <span class="pre">&lt;HOST_IP&gt;:65012</span></code> is configured in <code class="docutils literal notranslate"><span class="pre">config.json</span></code>, then expose the port 65012 in <code class="docutils literal notranslate"><span class="pre">build/docker-compose.yml</span></code> of the service <code class="docutils literal notranslate"><span class="pre">ia_video_ingestion</span></code></p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```yaml
  ia_video_ingestion:
    ...
    ports:
      - 65012:65012
```
</pre></div>
</div>
<hr class="docutils" />
<p>All the below EII build and run commands needs to be executed from the <code class="docutils literal notranslate"><span class="pre">[WORKDIR]/IEdgeInsights/build/</span></code> directory.</p>
<p>Below are the usecases supported by EII to bring up the respective services mentioned in the
yaml file.</p>
<p>Users can refer to section <strong>EII pre-requisites</strong> to generate the docker_compose.yml file based on the specific user case. For more detail information and configuration, you can refer to the <strong>[WORK_DIR]/IEdgeInsights/README</strong> file.</p>
<div class="section" id="build-eii-stack">
<h3>Build EII stack<a class="headerlink" href="#build-eii-stack" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>This step is optional if one wants to use the EII pre-built
container images itself and doesn’t want to build from source.
For more details, refer: <a class="reference external" href="http://localhost:7645/IEdgeInsights/#distribution-of-eii-container-images">Distribution of EII container images</a></p></li>
<li><p>Base EII services like ia_eiibase, ia_video_common etc., are required only at the build time and not at
the runtime.</p></li>
</ol>
</div>
<p>Builds all EII services in the <code class="docutils literal notranslate"><span class="pre">build/docker-compose-build.yml</span></code> along with the base EII services.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ docker-compose -f docker-compose-build.yml build
</pre></div>
</div>
<p>If any of the services fails during build, it can be built using below command</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ docker-compose -f docker-compose-build.yml build --no-cache &lt;service name&gt;
</pre></div>
</div>
</div>
<div class="section" id="run-eii-services">
<h3>Run EII services<a class="headerlink" href="#run-eii-services" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the images tagged with EII_VERSION as in <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/.env">build/.env</a> does not exist locally on the system,
they would be pulled if those images exist int he docker hub during <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span></code>.</p>
</div>
<p>Runs all the EII services in the <code class="docutils literal notranslate"><span class="pre">build/docker-compose.yml</span></code></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ xhost +
$ docker-compose up -d
</pre></div>
</div>
<p>A successful run will open Visualizer UI with results of video analytics for all video usecases.</p>
</div>
<div class="section" id="push-required-eii-images-to-docker-registry">
<h3>Push required EII images to docker registry<a class="headerlink" href="#push-required-eii-images-to-docker-registry" title="Permalink to this headline">¶</a></h3>
<p>Pushes all the EII service docker images in the <code class="docutils literal notranslate"><span class="pre">build/docker-compose-push.yml</span></code>. Ensure to update the DOCKER_REGISTRY value in <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/build/.env">.env</a> file.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ docker-compose -f docker-compose-push.yml push
</pre></div>
</div>
</div>
</div>
<div class="section" id="eii-multi-node-cluster-provision-and-deployment">
<h2>EII multi node cluster provision and deployment<a class="headerlink" href="#eii-multi-node-cluster-provision-and-deployment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="without-orchestrator">
<h3><strong>Without orchestrator</strong><a class="headerlink" href="#without-orchestrator" title="Permalink to this headline">¶</a></h3>
<p>By default EII is provisioned with single node cluster.</p>
<ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">Recommended</span></code>] Deploy on multiple nodes automatically through ansible playbook.</p></li>
</ul>
</div>
<div class="section" id="ansible-based-eii-prequisites-setup-provisioning-build-deployment">
<h3>Ansible based EII Prequisites setup, provisioning, build &amp; deployment<a class="headerlink" href="#ansible-based-eii-prequisites-setup-provisioning-build-deployment" title="Permalink to this headline">¶</a></h3>
<p>Ansible is the automation engine which can enable EII deployment across single/multi nodes.
We need one control node where ansible is installed and optional hosts. We can also use the control node itself to deploy EII</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Ansible can execute the tasks on control node based on the playbooks defined</p></li>
<li><p>There are 3 types of nodes - control node where ansible must be installed, EII leader node where ETCD server will be running and optional worker nodes, all worker nodes remotely connect to ETCD server running on leader node. Control node and EII leader node can be same.</p></li>
</ul>
</div>
</div>
<div class="section" id="installing-ansible-on-ubuntu-control-node">
<h3>Installing Ansible on Ubuntu {Control node}<a class="headerlink" href="#installing-ansible-on-ubuntu-control-node" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Execute the following command in the identified control node machine.
.. code-block:: sh</p>
<blockquote>
<div><p>$ sudo apt update
$ sudo apt install software-properties-common
$ sudo apt-add-repository –yes –update ppa:ansible/ansible
$ sudo apt install ansible</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="prerequisite-step-needed-for-all-the-control-worker-nodes">
<h3>Prerequisite step needed for all the control/worker nodes.<a class="headerlink" href="#prerequisite-step-needed-for-all-the-control-worker-nodes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="generate-ssh-key-for-all-nodes">
<h4>Generate SSH KEY for all nodes<a class="headerlink" href="#generate-ssh-key-for-all-nodes" title="Permalink to this headline">¶</a></h4>
<p>Generate the SSH KEY for all nodes using following command (to be executed in the only control node), ignore to run this command if you already have ssh keys generated in your system without id and passphrase,</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ssh-keygen
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Dont give any passphrase and id, just press <code class="docutils literal notranslate"><span class="pre">Enter</span></code> for all the prompt which will generate the key.</p>
</div>
<p>For Eg.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ssh-keygen

Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):  &lt;ENTER&gt;
Enter passphrase (empty for no passphrase):  &lt;ENTER&gt;
Enter same passphrase again:  &lt;ENTER&gt;
Your identification has been saved in ~/.ssh/id_rsa.
Your public key has been saved in ~/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:vlcKVU8Tj8nxdDXTW6AHdAgqaM/35s2doon76uYpNA0 root@host
The key&#39;s randomart image is:
+---[RSA 2048]----+
|          .oo.==*|
|     .   .  o=oB*|
|    o . .  ..o=.=|
|   . oE.  .  ... |
|      ooS.       |
|      ooo.  .    |
|     . ...oo     |
|      . .*o+.. . |
|       =O==.o.o  |
+----[SHA256]-----+
</pre></div>
</div>
</div>
</div>
<div class="section" id="adding-ssh-authorized-key-from-control-node-to-all-the-nodes">
<h3>Adding SSH Authorized Key from control node to all the nodes<a class="headerlink" href="#adding-ssh-authorized-key-from-control-node-to-all-the-nodes" title="Permalink to this headline">¶</a></h3>
<p>Please follow the steps to copy the generated keys from control node to all other nodes</p>
<p>Execute the following command from <code class="docutils literal notranslate"><span class="pre">control</span></code> node.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ssh-copy-id &lt;USER_NAME&gt;@&lt;HOST_IP&gt;
</pre></div>
</div>
<p>For Eg.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ssh-copy-id test@192.0.0.1

/usr/bin/ssh-copy-id: INFO: Source of key<span class="o">(</span>s<span class="o">)</span> to be installed: <span class="s2">&quot;/home/&lt;username&gt;/.ssh/id_rsa.pub&quot;</span>

Number of key<span class="o">(</span>s<span class="o">)</span> added: <span class="m">1</span>

Now try logging into the machine, with:   <span class="s2">&quot;ssh &#39;test@192.0.0.1&#39;&quot;</span>
and check to make sure that only the key<span class="o">(</span>s<span class="o">)</span> you wanted were added.
</pre></div>
</div>
<div class="section" id="configure-sudoers-file-to-accept-no-password-for-sudo-operation">
<h4>Configure Sudoers file to accept NO PASSWORD for sudo operation.<a class="headerlink" href="#configure-sudoers-file-to-accept-no-password-for-sudo-operation" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ansible need to execute some commands as <code class="docutils literal notranslate"><span class="pre">sudo</span></code>. The below configuration is needed so that <code class="docutils literal notranslate"><span class="pre">passwords</span></code> need not be saved in the ansible inventory file <code class="docutils literal notranslate"><span class="pre">hosts</span></code></p>
</div>
<p>Update <code class="docutils literal notranslate"><span class="pre">sudoers</span></code> file</p>
<ol class="arabic">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">sudoers</span></code> file.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ sudo visudo
</pre></div>
</div>
</li>
<li><p>Append the following to the <code class="docutils literal notranslate"><span class="pre">sudoers</span></code> file</p>
<blockquote>
<div><p><strong>Note</strong>
Please append to the last line of the <code class="docutils literal notranslate"><span class="pre">sudoers</span></code> file.</p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ &lt;ansible_non_root_user&gt;  <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> NOPASSWD: ALL
</pre></div>
</div>
<p>For E.g:</p>
<p>If in control node, the current non root user is <code class="docutils literal notranslate"><span class="pre">user1</span></code>, you should append as follows</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>user1 <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> NOPASSWD: ALL
</pre></div>
</div>
</li>
<li><p>Save &amp; Close the file</p></li>
<li><p>For checking the <code class="docutils literal notranslate"><span class="pre">sudo</span></code> access for the enabled <code class="docutils literal notranslate"><span class="pre">user</span></code>, please logout and login to the session again
check the following command.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ sudo -l -U &lt;ansible_non_root_user&gt;
</pre></div>
</div>
<p>Now the above line authorizes <code class="docutils literal notranslate"><span class="pre">user1</span></code> user to do <code class="docutils literal notranslate"><span class="pre">sudo</span></code> operation in the control node without <code class="docutils literal notranslate"><span class="pre">PASSWORD</span></code> ask.</p>
<blockquote>
<div><p><strong>Note</strong>
The same procedure applies to all other nodes where ansible connection is involved.</p>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="section" id="updating-the-leader-worker-node-s-information-for-using-remote-hosts">
<h3>Updating the leader &amp; worker node’s information for using remote hosts<a class="headerlink" href="#updating-the-leader-worker-node-s-information-for-using-remote-hosts" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By <code class="docutils literal notranslate"><span class="pre">default</span></code> both control/leader node <code class="docutils literal notranslate"><span class="pre">ansible_connection</span></code> will be <code class="docutils literal notranslate"><span class="pre">localhost</span></code> in single node deployment.</p>
</div>
<p>Please follow below steps to update the details of leader/worker nodes for multi node scenario.</p>
<ul>
<li><p>Update the hosts information in the inventory file <code class="docutils literal notranslate"><span class="pre">hosts</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span>
<span class="o">&lt;</span><span class="n">nodename</span><span class="o">&gt;</span> <span class="n">ansible_connection</span><span class="o">=</span><span class="n">ssh</span> <span class="n">ansible_host</span><span class="o">=&lt;</span><span class="n">ipaddress</span><span class="o">&gt;</span> <span class="n">ansible_user</span><span class="o">=&lt;</span><span class="n">machine_user_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For Eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">targets</span><span class="p">]</span>
<span class="n">leader</span> <span class="n">ansible_connection</span><span class="o">=</span><span class="n">ssh</span> <span class="n">ansible_host</span><span class="o">=</span><span class="mf">192.0</span><span class="o">.</span><span class="mf">0.1</span>  <span class="n">ansible_user</span><span class="o">=</span><span class="n">user1</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Note</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ansible_connection=ssh</span></code> is mandatory when you are updating any remote hosts, which makes ansible to connect via <code class="docutils literal notranslate"><span class="pre">ssh</span></code>.</p></li>
<li><p>The above information is used by ansible to establish ssh connection to the nodes.</p></li>
<li><p>control node will always be <code class="docutils literal notranslate"><span class="pre">ansible_connection=local</span></code>, <strong>don’t update the control node’s information</strong></p></li>
<li><p>To deploy EII in single , <code class="docutils literal notranslate"><span class="pre">ansible_connection=local</span></code> and <code class="docutils literal notranslate"><span class="pre">ansible_host=localhost</span></code></p></li>
<li><p>To deploy EII on multiple nodes, add hosts(worker1, worker2 etc..) details to the inventory file</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="non-orchestrated-multi-node-deployment-without-k8s">
<h3>Non-orchestrated multi node deployment (without k8s)<a class="headerlink" href="#non-orchestrated-multi-node-deployment-without-k8s" title="Permalink to this headline">¶</a></h3>
<p>Below configuration changes need to be made for multi node deployment without k8s</p>
<ol class="arabic">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">multi_node:</span> <span class="pre">true</span></code> in <code class="docutils literal notranslate"><span class="pre">group_vars/all.yml</span></code> to enable multinode deployment and <code class="docutils literal notranslate"><span class="pre">false</span></code> to enable single node deployment. Update <code class="docutils literal notranslate"><span class="pre">vars/vars.yml</span></code> to the services to run on a specific node in case of multi_node deployment by following <a class="reference external" href="http://localhost:7645/IEdgeInsights/build/ansible/#Select-EII-services-to-run-on-a-particular-node-in-multinode-deployment">this</a>, where in single node deployment all the services based on the <code class="docutils literal notranslate"><span class="pre">usecase</span></code> chosen will be deployed.</p></li>
<li><p>Update <code class="docutils literal notranslate"><span class="pre">docker</span></code> registry details in following section if using a custom/private registry
.. code-block:: sh</p>
<blockquote>
<div><p>docker_registry=”&lt;regsitry_url&gt;”
docker_login_user=”&lt;username&gt;”
docker_login_passwd=”&lt;password&gt;”</p>
</div></blockquote>
<blockquote>
<div><p><strong>Note</strong>
Use of <code class="docutils literal notranslate"><span class="pre">docker_registry</span></code> and <code class="docutils literal notranslate"><span class="pre">build</span></code> flags</p>
<ul class="simple">
<li><p>Update <code class="docutils literal notranslate"><span class="pre">docker_registry</span></code> details to use docker images from custom registry, optionally set <code class="docutils literal notranslate"><span class="pre">build:</span> <span class="pre">true</span></code> to push docker images to this registry</p></li>
<li><p>Unset <code class="docutils literal notranslate"><span class="pre">docker_registry</span></code> details if you don’t want to use custom registry and set <code class="docutils literal notranslate"><span class="pre">build:</span> <span class="pre">true</span></code> to save and load docker images from one node to another node</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If you are using images from docker hub, then set <code class="docutils literal notranslate"><span class="pre">build:</span> <span class="pre">false</span></code> and unset <code class="docutils literal notranslate"><span class="pre">docker_registry</span></code> details</p></li>
</ol>
</div>
<div class="section" id="select-eii-services-to-run-on-a-particular-node-in-multinode-deployment">
<h3>Select EII services to run on a particular node in multinode deployment<a class="headerlink" href="#select-eii-services-to-run-on-a-particular-node-in-multinode-deployment" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">vars/vars.yml</span></code> -&gt; under <code class="docutils literal notranslate"><span class="pre">nodes</span></code> add a specific a node which was defined in the inventory file(<code class="docutils literal notranslate"><span class="pre">hosts</span></code>) and add EII services to <code class="docutils literal notranslate"><span class="pre">include_services</span></code> list</p>
<blockquote>
<div><p>Eg. if you want leader to run ia_video_ingestion, <code class="docutils literal notranslate"><span class="pre">vars/vars.yml</span></code> should be</p>
</div></blockquote>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>nodes:
  leader:
    include_services:
        - ia_video_ingestion
</pre></div>
</div>
</li>
<li><p>If you want to add <code class="docutils literal notranslate"><span class="pre">worker1</span></code> to <code class="docutils literal notranslate"><span class="pre">nodes</span></code> and bring up <code class="docutils literal notranslate"><span class="pre">ia_visualizer</span></code> in <code class="docutils literal notranslate"><span class="pre">worker1</span></code>:</p>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>nodes:
  leader:
    include_services:
        - ia_video_ingestion
  worker1:
    include_services:
        - ia_visualizer
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a service is not added to <code class="docutils literal notranslate"><span class="pre">include_services</span></code> list, that service will not deployed on a particular node</p>
</div>
</div>
<div class="section" id="execute-ansible-playbook-from-eii-workdir-iedgeinsights-build-ansible-control-node-to-deploy-eii-services-in-single-multi-nodes">
<h3>Execute ansible Playbook from [EII_WORKDIR]/IEdgeInsights/build/ansible {Control node} to deploy EII services in single/multi nodes<a class="headerlink" href="#execute-ansible-playbook-from-eii-workdir-iedgeinsights-build-ansible-control-node-to-deploy-eii-services-in-single-multi-nodes" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Updating messagebus endpoints to connect to interfaces is still the manual process. Make sure to update Application specific endpoints in <code class="docutils literal notranslate"><span class="pre">[AppName]/config.json</span></code></p></li>
<li><p>After <code class="docutils literal notranslate"><span class="pre">pre-requisites</span></code> are successfully installed, please do logout and login to apply the changes</p></li>
</ul>
</div>
<p><strong>For Single Point of Execution</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>:
This will execute all the steps of EII as prequisite, build, provision, deploy &amp; setup leader node for multinode deployement usecase in one shot sequentialy.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  ```sh
  $ ansible-playbook eii.yml
  ```


**Below steps are the individual execution of setups.**
</pre></div>
</div>
<ul>
<li><p>Load <code class="docutils literal notranslate"><span class="pre">.env</span></code> values from template</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;load_env&quot;</span>
</pre></div>
</div>
</li>
<li><p>For EII Prequisite Setup</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;prerequisites&quot;</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Note</strong>
After <code class="docutils literal notranslate"><span class="pre">pre-requisites</span></code> are successfully installed, please do logout and login to apply the changes</p>
</div></blockquote>
</li>
<li><p>To generate builder and config files, build images and push to registry</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;build&quot;</span>
</pre></div>
</div>
</li>
<li><p>To generate Certificates in control node</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;gen_certs&quot;</span>
</pre></div>
</div>
</li>
<li><p>To generate provision bundle for leader</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;gen_leader_provision_bundle&quot;</span>
</pre></div>
</div>
</li>
<li><p>To generate provision bundle for worker nodes</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;gen_worker_provision_bundle&quot;</span>
</pre></div>
</div>
</li>
<li><p>To generate eii bundles for leader, worker nodes</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;gen_bundles&quot;</span>
</pre></div>
</div>
</li>
<li><p>Provision leader and bring up ETCD server</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;leader_provision&quot;</span>
</pre></div>
</div>
</li>
<li><p>Provision worker node</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;worker_provsion&quot;</span>
</pre></div>
</div>
</li>
<li><p>Provision EIS Config values to etcd</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;etcd_provision&quot;</span>
</pre></div>
</div>
</li>
<li><p>To generate deploy selected services to leader, worker nodes</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;deploy&quot;</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="deploying-eii-using-helm-in-kubernetes-k8s-environment">
<h4>Deploying EII Using Helm in Kubernetes (k8s) environment<a class="headerlink" href="#deploying-eii-using-helm-in-kubernetes-k8s-environment" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>To Deploy EII using helm in k8s aenvironment, <code class="docutils literal notranslate"><span class="pre">k8s</span></code> setup is a prerequisite.</p></li>
<li><p>You need update the <code class="docutils literal notranslate"><span class="pre">k8s</span></code> leader machine as leader node in <code class="docutils literal notranslate"><span class="pre">hosts</span></code> file.</p></li>
<li><p>Non <code class="docutils literal notranslate"><span class="pre">k8s</span></code> leader machine the <code class="docutils literal notranslate"><span class="pre">helm</span></code> deployment will fail.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">helm</span></code> deployment <code class="docutils literal notranslate"><span class="pre">ansible-multinode</span></code> parameters will not applicable, Since
node selection &amp; pod selection will be done by <code class="docutils literal notranslate"><span class="pre">k8s</span></code> orchestrator.</p></li>
<li><p>Make sure you are deleting <code class="docutils literal notranslate"><span class="pre">/opt/intel/eii/data</span></code> when switch from <code class="docutils literal notranslate"><span class="pre">prod</span></code> mode to
<code class="docutils literal notranslate"><span class="pre">dev</span></code> mode in all your <code class="docutils literal notranslate"><span class="pre">k8s</span></code> <code class="docutils literal notranslate"><span class="pre">worker</span></code> nodes.</p></li>
</ol>
</div>
<ul>
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">DEPLOYMENT_MODE</span></code> flag as <code class="docutils literal notranslate"><span class="pre">k8s</span></code> in <code class="docutils literal notranslate"><span class="pre">group_vars/all.yml</span></code> file:</p>
<ul>
<li><p>Open <code class="docutils literal notranslate"><span class="pre">group_vars/all.yml</span></code> file
.. code-block:: sh</p>
<blockquote>
<div><p>$ vi group_vars/all.yml</p>
</div></blockquote>
</li>
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">DEPLOYMENT_MODE</span></code> flag as <code class="docutils literal notranslate"><span class="pre">k8s</span></code></p>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>## Deploy in k8s mode using helm
DEPLOYMENT_MODE: &quot;k8s&quot;
</pre></div>
</div>
</li>
<li><p>Save &amp; Close</p></li>
</ul>
</li>
<li><p>For Single Point of Execution</p>
<blockquote>
<div><p><strong>Note</strong>
This will execute all the steps of EII as prequisite, build, provision, deploy for a usecase in one shot sequentialy.</p>
</div></blockquote>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Below steps are the individual execution of setups.</p>
</div>
<ul>
<li><p>Load <code class="docutils literal notranslate"><span class="pre">.env</span></code> values from template</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;load_env&quot;</span>
</pre></div>
</div>
</li>
<li><p>For EII Prequisite Setup</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;prerequisites&quot;</span>
</pre></div>
</div>
</li>
<li><p>For building EII containers</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;build&quot;</span>
</pre></div>
</div>
</li>
<li><p>To generate Certificates in control node</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;gen_certs&quot;</span>
</pre></div>
</div>
</li>
<li><p>Prerequisites for deploy EII using Ansible helm environment.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ansible-playbook eii.yml --tags <span class="s2">&quot;helm_k8s_prerequisites&quot;</span>
</pre></div>
</div>
</li>
<li><p>Provision &amp; Deploy EII Using Ansible helm environment
.. code-block:: sh</p>
<blockquote>
<div><p>$ ansible-playbook eii.yml –tags “helm_k8s_deploy”</p>
</div></blockquote>
</li>
<li><p>In order to deploy EII on multiple nodes using docker registry and provision ETCD, please follow <a class="reference external" href="http://localhost:7645/IEdgeInsights/build/deploy/README.html">build/deploy/README.html</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="with-k8s-orchestrator">
<h3><strong>With k8s orchestrator</strong><a class="headerlink" href="#with-k8s-orchestrator" title="Permalink to this headline">¶</a></h3>
<p>One of the below options could be tried out:</p>
<ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">Recommended</span></code>] For deploying through ansible playbook on multiple nodes automatically, please refer <a class="reference external" href="http://localhost:7645/IEdgeInsights/build/ansible/README.html##deploying-eii-using-helm-in-kubernetes-k8s-environment">build/ansible/README.html</a></p></li>
<li><p>Use helm charts to provision the node and deploy EII services</p></li>
</ul>
</div>
<div class="section" id="pre-requisites">
<h3>Pre requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h3>
<p>For preparing the necessary files required for the provision and deployment, user needs to execute the build and provision steps on an Ubuntu 18.04 / 20.04 machine.
Follow the Docker pre-requisites, EII Pre-requisites, Provision EII and Build and Run EII mentioned in <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/README.md">README.md</a> on the Ubuntu dev machine.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>:</p>
<p>K8s installation on single or multi node should be done as pre-requisite to continue the following deployment.</p>
<p>builder.py need to be executed with the preferred usecase for generating the consolidated helm charts for the provisioning and deployment.</p>
<p>For helm installation refer <a class="reference external" href="https://helm.sh/docs/intro/install/">helm website</a>.</p>
<p><strong>Note</strong>:
To run eii services with helm in fresh system where EII services are going to run for the first time(no eiiuser is present on that system), user needs to run below steps:</p>
<ol class="arabic">
<li><p>Create eii user if not exists:
.. code-block:: sh</p>
<blockquote>
<div><p>$ set -a
$ source ../.env
$ set +a
$ groupadd $EII_USER_NAME -g $EII_UID
$ useradd -r -u $EII_UID -g $EII_USER_NAME $EII_USER_NAME</p>
</div></blockquote>
</li>
<li><p>Create required directory and change ownership to eiiuser
.. code-block:: sh</p>
<blockquote>
<div><p>$ mkdir -p $EII_INSTALL_PATH/data/influxdata
$ mkdir -p $EII_INSTALL_PATH/sockets/
$ chown -R $EII_USER_NAME:$EII_USER_NAME $EII_INSTALL_PATH</p>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="section" id="update-the-helm-charts-directory">
<h3>Update the helm charts directory<a class="headerlink" href="#update-the-helm-charts-directory" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Copy the docker-compose.yml, eii_config.json into the eii-provision helm chart.
.. code-block:: sh</p>
<blockquote>
<div><p>$ cd [WORKDIR]/IEdgeInsights/build
$ cp docker-compose.yml provision/config/eii_config.json helm-eii/eii-provision/</p>
</div></blockquote>
</li>
<li><p>To generate only Certificates by provisioning.
.. code-block:: sh</p>
<blockquote>
<div><p>$ cd [WORKDIR]/IEdgeInsights/build/provision
$ sudo -E ./provision.sh ../docker-compose.yml –generate_certs</p>
</div></blockquote>
</li>
<li><p>Copy the Certificates generated by provisioning process to the eii-provision helm chart.
.. code-block:: sh</p>
<blockquote>
<div><p>$ cd [WORKDIR]/IEdgeInsights/build
$ sudo chmod -R 755 provision/Certificates/
$ cp -a provision/Certificates/ helm-eii/eii-provision/</p>
</div></blockquote>
<blockquote>
<div><p><strong>Note</strong>:
The Certificates/ directory contains sensitive information. So post the installation of eii-provision helm chart, it is recommended to delete the Certificates from it.</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="provision-and-deploy-in-the-kubernetes-node">
<h3>Provision and deploy in the kubernetes node.<a class="headerlink" href="#provision-and-deploy-in-the-kubernetes-node" title="Permalink to this headline">¶</a></h3>
<p>Copy the helm charts in helm-eii/ directory to the node.</p>
<ol class="arabic">
<li><p>Install provision helm chart</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">[</span>WORKDIR<span class="o">]</span>/IEdgeInsights/build/helm-eii/
$ helm install eii-provision eii-provision/
</pre></div>
</div>
<p>Verify the pod is in running state:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ kubectl get pods

NAME                       READY   STATUS    RESTARTS   AGE
ia-etcd-58866469b9-dl66k   <span class="m">2</span>/2     Running   <span class="m">0</span>          8s
</pre></div>
</div>
</li>
<li><p>Install deploy helm chart</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">[</span>WORKDIR<span class="o">]</span>/IEdgeInsights/build/helm-eii/
$ helm install eii-deploy eii-deploy/
</pre></div>
</div>
<p>Verify all the pod are running:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ kubectl get pods

NAME                                          READY   STATUS    RESTARTS   AGE
deployment-etcd-ui-6c7c6cd769-rwqm6           <span class="m">1</span>/1     Running   <span class="m">0</span>          11s
deployment-video-analytics-546574f474-mt7wp   <span class="m">1</span>/1     Running   <span class="m">0</span>          11s
deployment-video-ingestion-979dd8998-9mzkh    <span class="m">1</span>/1     Running   <span class="m">0</span>          11s
deployment-webvisualizer-6c9d56694b-4qhnw     <span class="m">1</span>/1     Running   <span class="m">0</span>          11s
ia-etcd-58866469b9-dl66k                      <span class="m">2</span>/2     Running   <span class="m">0</span>          2m26s
</pre></div>
</div>
</li>
</ol>
<p>The EII is now successfully deployed.</p>
</div>
<div class="section" id="provision-and-deploy-mode-in-times-switching-between-dev-and-prod-mode-or-changing-the-usecase">
<h3>Provision and deploy mode in times switching between dev and prod mode OR changing the usecase<a class="headerlink" href="#provision-and-deploy-mode-in-times-switching-between-dev-and-prod-mode-or-changing-the-usecase" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Set the DEV_MODE as “true/false” in  <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/env">.env</a> depending on dev or prod mode.</p></li>
<li><p>Run builder to copy templates file to eii-deploy/templates directory and generate consolidated values.yaml file for eii-services:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">[</span>WORKDIR<span class="o">]</span>/IEdgeInsights/build
$ python3 builder.py -f usecases/&lt;usecase&gt;.yml
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>:
<code class="docutils literal notranslate"><span class="pre">ia_kapacitor</span></code> and <code class="docutils literal notranslate"><span class="pre">ia_telegraf</span></code> container images are not distributed via docker hub, so one won’t be able to pull these images
for time-series use case upon using <cite>../usecases/time-series.yml &lt;https://github.com/open-edge-insights/eii-core/blob/master/usecases/time-series.yml</cite>&gt;`_ for deployment. For more details,
refer: [../README.md#distribution-of-eii-container-images]&gt; (../README.md#distribution-of-eii-container-images).</p>
</div>
<ol class="arabic">
<li><p>Remove the etcd storage directory
.. code-block:: sh</p>
<blockquote>
<div><p>$sudo rm -rf /opt/intel/eii/data/*</p>
</div></blockquote>
</li>
</ol>
<p>Do helm install of provision and deploy charts as per previous section.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>:
Please wait for all the pods terminated successfully, In times of re-deploy helm chart for eii-provision and eii-deploy</p>
</div>
</div>
<div class="section" id="steps-to-enable-accelarators">
<h3>Steps to enable Accelarators<a class="headerlink" href="#steps-to-enable-accelarators" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>:
<code class="docutils literal notranslate"><span class="pre">nodeSelector</span></code> is the simplest recommended form of node selection constraint.
<code class="docutils literal notranslate"><span class="pre">nodeSelector</span></code> is a field of PodSpec. It specifies a map of key-value pairs. For the pod to be eligible to run on a node, the node must have each of the indicated key-value pairs as labels (it can have additional labels as well). The most common usage is one key-value pair.</p>
</div>
<ol class="arabic">
<li><p>Setting the <code class="docutils literal notranslate"><span class="pre">label</span></code> for a particular node</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ kubectl label nodes &lt;node-name&gt; &lt;label-key&gt;<span class="o">=</span>&lt;label-value&gt;
</pre></div>
</div>
</li>
<li><p>For HDDL/NCS2 dependenecies follow the steps for setting <code class="docutils literal notranslate"><span class="pre">labels</span></code>.</p>
<ul class="simple">
<li><p>For HDDL</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ kubectl label nodes &lt;node-name&gt; <span class="nv">hddl</span><span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<ul class="simple">
<li><p>For NCS2</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>kubectl label nodes &lt;node-name&gt; <span class="nv">ncs2</span><span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>: Here the node-name is your worker node machine hostname</p>
</div>
<ol class="arabic">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">[WORKDIR]/IEdgeInsights/VideoIngestion/helm/values.yaml</span></code> or <code class="docutils literal notranslate"><span class="pre">[WORKDIR]/IEdgeInsights/VideoAnalytics/helm/values.yaml</span></code> file.</p></li>
<li><p>Based on your workload preference. Add hddl or ncs2 to accelerator in values.yaml of video-ingestion or video-analytics.</p>
<ul class="simple">
<li><p>For HDDL</p></li>
</ul>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>config:
 video_ingestion:
    .
    .
    .
   accelerator: &quot;hddl&quot;
   .
   .
   .
</pre></div>
</div>
<ul class="simple">
<li><p>For NCS2</p></li>
</ul>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>config:
 video_ingestion:
    .
    .
    .
   accelerator: &quot;ncs2&quot;
   .
   .
   .
</pre></div>
</div>
</li>
<li><p>set device as “MYRIAD” in case of ncs2 and as HDDL in case of hddl in the <a class="reference external" href="https://github.com/open-edge-insights/video-analytics/blob/master/config.json">VA config</a></p>
<ul class="simple">
<li><p>In case of ncs2.</p></li>
</ul>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>&quot;udfs&quot;: [{
 .
 .
 .
 &quot;device&quot;: &quot;MYRIAD&quot;
 }]
</pre></div>
</div>
<ul class="simple">
<li><p>In case of hddl.</p></li>
</ul>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>&quot;udfs&quot;: [{
 .
 .
 .
 &quot;device&quot;: &quot;HDDL&quot;
 }]
</pre></div>
</div>
</li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">[WORKDIR]/IEdgeInsights/build/builder.py</span></code> for generating latest consolidated <code class="docutils literal notranslate"><span class="pre">deploy</span></code> yml file based on your <code class="docutils literal notranslate"><span class="pre">nodeSelector</span></code> changes set in the respective Modules.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="o">[</span>WORKDIR<span class="o">]</span>/IEdgeInsights/build/
python3 builder.py
</pre></div>
</div>
</li>
<li><p>Follow the <a class="reference external" href="http://localhost:7645/IEdgeInsights/build/helm-eii/##Provision-and-deploy-in-the-kubernetes-node">Deployment Steps</a></p></li>
<li><p>Verify the respecitve workloads are running based on the <code class="docutils literal notranslate"><span class="pre">nodeSelector</span></code> constraints.</p></li>
</ol>
</div>
<div class="section" id="steps-for-enabling-gige-camera-with-helm">
<h3>Steps for Enabling GiGE Camera with helm<a class="headerlink" href="#steps-for-enabling-gige-camera-with-helm" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt><strong>Note:</strong> For more information on <code class="docutils literal notranslate"><span class="pre">Multus</span></code> please refer this git <a class="reference external" href="https://github.com/intel/multus-cni">https://github.com/intel/multus-cni</a></dt><dd><p>Skip installing multus if it is already installed.</p>
</dd>
</dl>
<ol class="arabic">
<li><p>Prequisites
For enabling gige camera with helm. Helm pod networks should be enabled <code class="docutils literal notranslate"><span class="pre">Multus</span></code> Network Interface
to attach host system network interface access by the pods for connected camera access.</p>
<p><strong>Note</strong>: Please follow the below steps &amp; make sure <code class="docutils literal notranslate"><span class="pre">dhcp</span> <span class="pre">daemon</span></code> is running fine.If there is an error on <code class="docutils literal notranslate"><span class="pre">macvlan</span></code> container creation on accessing the socket or if socket was not running. Please execute the below steps again</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ sudo rm -f /run/cni/dhcp.sock
$ <span class="nb">cd</span> /opt/cni/bin
$ sudo ./dhcp daemon
</pre></div>
</div>
<p>### Setting up Multus CNI and Enabling it.</p>
<ul class="simple">
<li><p>Multus CNI is a container network interface (CNI) plugin for Kubernetes that enables attaching multiple network interfaces to pods. Typically, in Kubernetes each pod only has one network interface (apart from a loopback) – with Multus you can create a multi-homed pod that has multiple interfaces. This is accomplished by Multus acting as a “meta-plugin”, a CNI plugin that can call multiple other CNI plugins.</p></li>
</ul>
<ol class="arabic simple">
<li><p>Get the name of the <code class="docutils literal notranslate"><span class="pre">ethernet</span></code> interface in which gige camera &amp; host system connected
<strong>Note</strong>: Identify the network interface name by following command</p></li>
</ol>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ifconfig
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Execute the Following Script with Identified <code class="docutils literal notranslate"><span class="pre">ethernet</span></code> interface name as Argument for <code class="docutils literal notranslate"><span class="pre">Multus</span> <span class="pre">Network</span> <span class="pre">Setup</span></code>
<strong>Note:</strong> Pass the <code class="docutils literal notranslate"><span class="pre">interface</span></code> name without <code class="docutils literal notranslate"><span class="pre">quotes</span></code></p></li>
</ol>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">[</span>WORKDIR<span class="o">]</span>/IEdgeInsights/build/helm-eii/gige_setup
$ sudo -E sh ./multus_setup.sh &lt;interface_name&gt;
</pre></div>
</div>
<blockquote>
<div><p><strong>Note</strong>: Verify <code class="docutils literal notranslate"><span class="pre">multus</span></code> pod is in <code class="docutils literal notranslate"><span class="pre">Running</span></code> state</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ kubectl get pods --all-namespaces <span class="p">|</span> grep -i multus
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple">
<li><p>Set gige_camera to true in values.yaml</p></li>
</ol>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ vi <span class="o">[</span>WORKDIR<span class="o">]</span>/IEdgeInsights/VideoIngestion/helm/values.yaml
.
.
.
gige_camera: <span class="nb">true</span>
.
.
.
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Follow the <a class="reference external" href="http://localhost:7645/IEdgeInsights/build/helm-eii/##Provision-and-deploy-in-the-kubernetes-node">Deployment Steps</a></p></li>
<li><p>Verify <code class="docutils literal notranslate"><span class="pre">pod</span></code>ip &amp; <code class="docutils literal notranslate"><span class="pre">host</span></code> ip are same as per Configured <code class="docutils literal notranslate"><span class="pre">Ethernet</span></code> interface by using below command.</p></li>
</ol>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ kubectl -n eii <span class="nb">exec</span> -it &lt;pod_name&gt; -- ip -d address
</pre></div>
</div>
<p><strong>Note:</strong></p>
<p>User needs to deploy as root user for MYRIAD(NCS2) device and GenICam USB3.0 interface cameras.</p>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="o">...</span>
<span class="n">spec</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="o">...</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="o">....</span>
        <span class="n">securityContext</span><span class="p">:</span>
          <span class="n">runAsUser</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-web-visualizer-and-etcdui">
<h3>Accessing Web Visualizer and EtcdUI<a class="headerlink" href="#accessing-web-visualizer-and-etcdui" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Environment EtcdUI &amp; WebVisualizer will be running in Following ports.</p>
</div></blockquote>
<ul class="simple">
<li><p>EtcdUI</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">https://master-nodeip:30010/</span></code></p></li>
</ul>
</li>
<li><p>WebVisualizer</p>
<ul>
<li><p>PROD Mode –  <code class="docutils literal notranslate"><span class="pre">https://master-nodeip:30007/</span></code></p></li>
<li><p>DEV Mode – <code class="docutils literal notranslate"><span class="pre">http://master-nodeip:30009/</span></code></p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="eii-uninstaller">
<h2>EII Uninstaller<a class="headerlink" href="#eii-uninstaller" title="Permalink to this headline">¶</a></h2>
<p>The uninstaller script automates the removal of all the EII Docker configuration installed on a system. This uninstaller will perform the following tasks:</p>
<ol class="arabic simple">
<li><p><strong>Stops and removes all EII running and stopped containers</strong></p></li>
<li><p><strong>Removes all EII docker volumes</strong></p></li>
<li><p><strong>Removes all EII docker images [Optional]</strong></p></li>
<li><p><strong>Removes all EII install directory</strong></p></li>
</ol>
<p>Run the below commmand from <code class="docutils literal notranslate"><span class="pre">[WORKDIR]/IEdgeInsights/build/</span></code> directory.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ./eii_uninstaller.sh -h
Usage: ./eii_uninstaller.sh <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-d<span class="o">]</span>

 This script uninstalls previous EII version.
 Where:
    -h show the <span class="nb">help</span>
    -d triggers the deletion of docker images <span class="o">(</span>by default it will not trigger<span class="o">)</span>

 Example:
  <span class="m">1</span><span class="o">)</span> Deleting only EII Containers and Volumes
    $ ./eii_uninstaller.sh

  <span class="m">2</span><span class="o">)</span> Deleting EII Containers, Volumes and Images
    $ <span class="nb">export</span> <span class="nv">EII_VERSION</span><span class="o">=</span><span class="m">2</span>.4
    $ ./eii_uninstaller.sh -d
    above example will delete EII containers, volumes and all the docker images having <span class="m">2</span>.4 version.
</pre></div>
</div>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<div class="section" id="debugging-through-the-logs">
<h3>Debugging Through the Logs<a class="headerlink" href="#debugging-through-the-logs" title="Permalink to this headline">¶</a></h3>
<p>For any service run in the EII stack, please use <strong>docker logs -f &lt;service_name&gt;</strong></p>
<p>EII sets up the Docker containers using the docker-compose tool. If only minor changes are made in the user-defined functions without adding any new files, user can just restart the specific docker container by running <strong>$ docker restart &lt;Cointainer_ID&gt;</strong> in the build directory without rebuilding the whole EII container.</p>
<p>Other useful commands when using the make tool are:</p>
<p><strong>docker-compose build</strong> : Will build the images for EII components, however will not start the EII</p>
<p><strong>docker-compose up –build</strong> : Will build the images for EII components and starts EII</p>
<p><strong>docker-compose up</strong> :  Will starts EII.</p>
<p><strong>docker-compose down</strong> : Will stop the EII.</p>
<p>Docker compose is a tool used to define and run multiple container applications using Docker. It is a wrapper around Docker that is responsible for creating a network and adding the containers to that network. By default, the bridge network is used, unless otherwise specified in the <strong>docker-compose.yml</strong> or <strong>docker-compose.yaml</strong> file.</p>
<p>More details about the <strong>docker-compose</strong> and <strong>docker-compose.yml</strong> files is available at</p>
<p><a class="reference external" href="https://docs.docker.com/compose/">Docker compose</a></p>
<p><a class="reference external" href="https://docs.docker.com/compose/reference/overview/">Docker compose CLI</a></p>
<p><a class="reference external" href="https://docs.docker.com/compose/compose-file/">Docker compose file reference</a></p>
<p><a class="reference external" href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a></p>
<p><a class="reference external" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Best practices for writing Dockerfiles</a></p>
<p><a class="reference external" href="https://docs.docker.com/engine/reference/builder/">Docker commands</a></p>
<p>The following list includes the most used docker-compose commands. These commands should come in handy during development and debugging of the EII stack:</p>
<ul class="simple">
<li><p><strong>docker-compose build</strong>  Builds all the service containers at the same time. To build a single service container, use <strong>docker-compose build [serv_cont_name]</strong>.</p></li>
</ul>
<blockquote>
<div><p>This command generates several EII images. The docker images | grep ia | sort command can be used to see a list of these images.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If any source files are modified, the docker-compose build command must be re-run to see the changes reflected within the container.</p>
</div>
<ul class="simple">
<li><p><strong>docker-compose down</strong>  Stops and removes the service containers. Also, removes the Docker network.</p></li>
<li><p><strong>docker-compose up d</strong>  Brings up the service containers in detached mode (-d) by picking up the changes made in the docker-compose.yml file. It creates a Docker network and joins these containers to it.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use the following command to see the list of running EII containers: docker ps:</p>
</div>
<ul class="simple">
<li><p><strong>docker-compose logs -f</strong>  Blocking process to see the Docker logs of all the containers. To see the logs for a single container, use docker logs f [serv_cont_name].</p></li>
<li><p>To run the Docker images separately, use the command: <strong>docker-compose run –no-deps [service_cont_name]</strong>.</p></li>
</ul>
<blockquote>
<div><p>For example: <strong>docker-compose run –name ia_video_ingestion –no-deps ia_video_ingestion</strong></p>
<p>Will run only the Video Ingestion container (the switch <strong>–no-deps</strong> will not bring up the dependencies configured in the docker-compose file).</p>
<p>If the container is not launching correctly, there could be an issue with the containers entrypoint program which can be overridden by providing the extra switch <strong>–entrypoint /bin/bash</strong> before the service container name in the <strong>docker-compose run</strong> command above. This creates a shell inside the container to run the actual entrypoint program from the container’s terminal to determine the root cause of the issue.</p>
<p>If the container is already running, to get a shell inside the container to perform additional operations, use the command: <strong>docker exec [service_cont_name] /bin/bash</strong> or <strong>docker exec -it [cont_name] /bin/bash</strong></p>
<p>For example: <strong>docker-exec -it ia_data_analytics /bin/bash</strong></p>
</div></blockquote>
</div>
<div class="section" id="debugging-video-ingestion-through-gst-launch">
<h3>Debugging Video Ingestion Through gst-launch<a class="headerlink" href="#debugging-video-ingestion-through-gst-launch" title="Permalink to this headline">¶</a></h3>
<p>There is attribute named “pipeline” in the EII ConfigMgr for VideoIngestion. This attribute is used to mention the source of the video frame. For example:</p>
<p>“pipeline”: “rtspsrc location=”<a class="reference external" href="rtsp://localhost:8554/">rtsp://localhost:8554/</a>” latency=100 ! <strong>rtph264depay ! h264parse ! mfxdecode ! videoconvert ! appsink</strong>”.</p>
<p>The <strong>bold text</strong> in the above example are the GStreamer element/plugins.</p>
<p>A list of valid GStreamer plugins or elements can be found at</p>
<p>To know which plugins are installed, use the command <strong>gst-inspect-1.0.</strong> This command will display all installed plugins.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These steps should only be followed if pipeline has been modified by the SI.</p>
</div>
<p>If the SI modifies the value of the pipeline attribute (an attribute from the factory.json file) which causes video ingestion to stop working, use the <strong>gst-launch-1.0</strong> command inside the video ingestion container. To get the granular logs from this command line utility, set the environment variable <strong>GST_DEBUG</strong>. The value can range from 1 to 5.</p>
<p>For example, consider a case in which the video_str attribute has been modified. The new value has an invalid GStreamer element or plugin, say:</p>
<blockquote>
<div><p>rtspsrc location=”<a class="reference external" href="rtsp://localhost:8554/">rtsp://localhost:8554/</a>” latency=100 ! rtph264depay ! <a href="#id14"><span class="problematic" id="id15">:red:`h264parse123`</span></a> ! avdec_h264 ! videoconvert ! appsink</p>
</div></blockquote>
<p>Consequently, video ingestion starts showing:</p>
<blockquote>
<div><p>2019-05-22 01:12:14,387 : ERROR : algos.dpm.ingestion.video : [video.py] :_run : in line : [183] : Failed to retrieve frame from camera cam_serial3</p>
<p>2019-05-22 01:12:14,388 : ERROR : algos.dpm.ingestion.video : [video.py] :_run : in line : [183] : Failed to retrieve frame from camera cam_serial1</p>
</div></blockquote>
<p>In this example, <strong>h264parse123</strong> is not a valid GStreamer plugin or element.</p>
<p>To debug this issue:</p>
<ol class="arabic simple">
<li><p>Go inside the container using the command: <strong>docker exec -it -u root ia_video_ingestion bash</strong></p></li>
<li><p>Set the GST_DEBUG variable (“export GST_DEBUG=3”).</p></li>
<li><p>Use the below command and examine the logs.</p></li>
</ol>
<blockquote>
<div><p>gst-launch-1.0 <strong>rtspsrc location=”rtsp://localhost:8554/” latency=100 ! rtph264depay ! :red:`h264parse123` ! avdec_h264 ! videoconvert ! appsink</strong></p>
<p>The <strong>bold text</strong> in the command above is exactly the value of the pipeline attribute. Since, <a href="#id16"><span class="problematic" id="id17">:red:`h264parse123`</span></a> is not a valid GStreamer plugin or element, using the above command will result in a log with the following ERROR messages.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>0:00:00.018350108    85       0xe31750 :red:`ERROR`           GST_PIPELINE grammar.y:716:priv_gst_parse_yyparse: no element &quot;h264parse123&quot;
0:00:00.018434694    85       0xe31750 :red:`ERROR`           GST_PIPELINE grammar.y:801:priv_gst_parse_yyparse: link has no sink [source=@0xe44080]
0:00:00.018473162    85       0xe31750 :red:`ERROR`           GST_PIPELINE grammar.y:716:priv_gst_parse_yyparse: no element &quot;avdec_h264&quot;
0:00:00.018497100    85       0xe31750 :red:`ERROR`           GST_PIPELINE grammar.y:801:priv_gst_parse_yyparse: link has no source [sink=@(nil)]
0:00:00.019408613    85       0xe31750 :red:`ERROR`           GST_PIPELINE grammar.y:801:priv_gst_parse_yyparse: link has no source [sink=@0xe50f30]
WARNING: erroneous pipeline: no element &quot;h264parse123&quot;
</pre></div>
</div>
<p>Therefore, using the <strong>gst-launch-1.0 command</strong> line utility has revealed that there is no h264parse123 <a href="#id18"><span class="problematic" id="id19">:red:`h264parse123`</span></a>. Now we need to check whether the plugin is valid and whether it has been installed. The <strong>gst-inspect-1.0</strong> command can be used to check whether the plugin has been installed.</p>
</div></blockquote>
</div>
<div class="section" id="enablement-of-x11-forwarding-for-eii-visualizer-container">
<h3>Enablement of X11 Forwarding for EII Visualizer Container<a class="headerlink" href="#enablement-of-x11-forwarding-for-eii-visualizer-container" title="Permalink to this headline">¶</a></h3>
<p>In EII, <strong>ia_visualizer</strong> is a reference application that visualizes the video analytics results. For simplicity, its X11 GUI output is defaulted to display on localhost:0, the console. However, this can cause problems on headless devices or devices where a developer does not have physical/virtual access to the console.</p>
<p>When a user does SSH with X11 forwarding enabled, for example, with the -X option, and the user is using X11 (the DISPLAY environment variable is set), the connection to the X11 display is automatically forwarded to the remote side in such a way that any X11 programs started from the shell (or command) will go through the encrypted channel, and the connection to the real X server will be made from the local machine</p>
<ul class="simple">
<li><p>Create a bash shell script and save it as Visualizer/startup.sh with the following content:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

if [ -n ${HOSTXAUTH} ] &amp;&amp; [ -f ${HOSTXAUTH} ]
then
if [ -n ${XAUTHORITY} ]
then
    [ -f ${XAUTHORITY} ] || touch ${XAUTHORITY}
    xauth -inf ${HOSTXAUTH} nlist | sed -e &#39;s/^..../ffff/&#39; | xauth -f ${XAUTHORITY} nmerge -
fi
fi

python3.6 ./visualize.py
</pre></div>
</div>
<ul class="simple">
<li><p>Set the execution permission</p></li>
</ul>
<blockquote>
<div><p><strong>$ chmod 744 startup.sh</strong></p>
</div></blockquote>
<ul class="simple">
<li><p>In Visualizer/Dockerfile add the bold section</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Installing dependencies</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span><span class="o">.</span><span class="mi">6</span><span class="o">-</span><span class="n">tk</span>

<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">xauth</span>

<span class="n">COPY</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span> <span class="o">.</span>
<span class="n">RUN</span> <span class="n">pip3</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>

<span class="n">COPY</span> <span class="n">visualize</span><span class="o">.</span><span class="n">py</span> <span class="o">.</span>

<span class="n">COPY</span> <span class="n">startup</span><span class="o">.</span><span class="n">sh</span> <span class="o">.</span>

<span class="c1">#Removing build dependencies</span>
</pre></div>
</div>
<ul class="simple">
<li><p>At the end of the <strong>Visualizer/Dockerfile</strong>, comment out the line that starts visualize.py and run startup.sh instead</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ENTRYPOINT [&quot;python3.6&quot;, &quot;visualize.py&quot;]</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;./startup.sh&quot;</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Open the <strong>build/docker-compose.yml</strong>, update below parameter under <strong>ia_visualizer</strong> section</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>EII_UID: ${ EII_UID}
EII_USER_NAME: ${ EII_USER_NAME}
#read_only: true
image: ${DOCKER_REGISTRY}ia_visualizer:${ EII_VERSION}

volumes:
- &quot;${ EII_INSTALL_PATH}/saved_images:${ EII_INSTALL_PATH}/saved_images&quot;
- &quot;vol_eii_socket:${SOCKET_DIR}&quot;
#user: ${EII_UID}

environment:
    AppName: &quot;Visualizer&quot;
    #DISPLAY: &quot;:0&quot;
    DISPLAY: $DISPLAY
    HOSTXAUTH: &quot;/tmp/host-xauth&quot;
    XAUTHORITY: /tmp/.Xauthority
</pre></div>
</div>
<ul class="simple">
<li><p>In the volumes section add the line in bold below. This mounts the <strong>.Xauthority</strong> file from the host to the running container.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">volumes</span><span class="p">:</span>
<span class="o">-</span> <span class="s2">&quot;$</span><span class="si">{EII_INSTALL_PATH}</span><span class="s2">/saved_images:$</span><span class="si">{EII_INSTALL_PATH}</span><span class="s2">/saved_images&quot;</span>
<span class="o">-</span> <span class="s2">&quot;/tmp/.X11-unix:/tmp/.X11-unix&quot;</span>
<span class="o">-</span> <span class="s2">&quot;vol_eii_socket:$</span><span class="si">{SOCKET_DIR}</span><span class="s2">&quot;</span>
<span class="o">-</span> <span class="s2">&quot;$</span><span class="si">{HOME}</span><span class="s2">/.Xauthority:/tmp/host-xauth:ro&quot;</span>
</pre></div>
</div>
<p>This concept has been tested and verified in single-node as well as multi-node setups. Note that it takes a live SSH connection and valid X11 authorization cookies on both ends, local and remote, for this to work, this SSH connection must be kept alive during the time you want your Visualizer to run. If the SSH connection can’t be established or is torn down in the middle of operation, errors are thrown from the Visualizer container. Below is the example of the EII Visualizer App.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/visualizer.png"><img alt="../_images/visualizer.png" src="../_images/visualizer.png" style="width: 300.5px; height: 278.5px;" /></a>
</div>
</div>
<div class="section" id="debugging-options">
<h3>Debugging options<a class="headerlink" href="#debugging-options" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>To check if all the EII images are built successfully, use cmd: <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">images|grep</span> <span class="pre">ia</span></code> and
to check if all containers are running, use cmd: <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code> (<code class="docutils literal notranslate"><span class="pre">one</span> <span class="pre">should</span> <span class="pre">see</span> <span class="pre">all</span> <span class="pre">the</span> <span class="pre">dependency</span> <span class="pre">containers</span> <span class="pre">and</span> <span class="pre">EII</span> <span class="pre">containers</span> <span class="pre">up</span> <span class="pre">and</span> <span class="pre">running</span></code>). If you see issues where the build is failing due to non-reachability to Internet, please ensure you have correctly configured proxy settings and restarted docker service. Even after doing this, if you are running into the same issue, please add below instrcutions to all the dockerfiles in <code class="docutils literal notranslate"><span class="pre">build\dockerfiles</span></code> at the top after the LABEL instruction and retry the building EII images:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ENV http_proxy http://proxy.iind.intel.com:911
ENV https_proxy http://proxy.iind.intel.com:911
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code> should list all the enabled containers which are included in docker-compose.yml</p></li>
<li><p>To verify if the default video pipeline with EII is working fine i.e., from video ingestion-&gt;video analytics-&gt;visualizer, please check the visualizer UI</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/opt/intel/eii</span></code> root directory gets created - This is the installation path for EII:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data/</span></code> - stores the backup data for persistent imagestore and influxdb</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sockets/</span></code> - stores the IPC ZMQ socket files</p></li>
</ul>
</li>
</ol>
<hr class="docutils" />
<p><strong>Note</strong>:</p>
<ol class="arabic simple">
<li><p>Few useful docker-compose and docker commands:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">-f</span> <span class="pre">docker-compose-build.yml</span> <span class="pre">build</span></code> - builds all the service containers. To build a single service container, use <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">-f</span> <span class="pre">docker-compose-build.yml</span> <span class="pre">build</span> <span class="pre">[serv_cont_name]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">down</span></code> - stops and removes the service containers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span> <span class="pre">-d</span></code> - brings up the service containers by picking the changes done in <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code> - check running containers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span> <span class="pre">-a</span></code> - check running and stopped containers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">stop</span> <span class="pre">$(docker</span> <span class="pre">ps</span> <span class="pre">-a</span> <span class="pre">-q)</span></code> - stops all the containers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">rm</span> <span class="pre">$(docker</span> <span class="pre">ps</span> <span class="pre">-a</span> <span class="pre">-q)</span></code> - removes all the containers. Useful when you run into issue of already container is in use.</p></li>
<li><p><a class="reference external" href="https://docs.docker.com/compose/reference/overview/">docker compose cli</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/compose/compose-file/">docker compose reference</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/cli/#configuration-files">docker cli</a></p></li>
</ul>
</li>
<li><p>If you want to run the docker images separately i.e, one by one, run the command <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">run</span> <span class="pre">--no-deps</span> <span class="pre">[service_cont_name]</span></code> Eg: <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">run</span> <span class="pre">--name</span> <span class="pre">ia_video_ingestion</span> <span class="pre">--no-deps</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">ia_video_ingestion</span></code> to run VI container and the switch <code class="docutils literal notranslate"><span class="pre">--no-deps</span></code> will not bring up it’s dependencies mentioned in the docker-compose file. If the container is not launching, there could be
some issue with entrypoint program which could be overrided by providing this extra switch <code class="docutils literal notranslate"><span class="pre">--entrypoint</span> <span class="pre">/bin/bash</span></code> before the service container name in the docker-compose run command above, this would let one inside the container and run the actual entrypoint program from the container’s terminal to rootcause the issue. If the container is running and one wants to get inside, use cmd: <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">exec</span> <span class="pre">[service_cont_name]</span> <span class="pre">/bin/bash</span></code> or <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">-it</span> <span class="pre">[cont_name]</span> <span class="pre">/bin/bash</span></code></p></li>
<li><p>Best way to check logs of containers is to use command: <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">-f</span> <span class="pre">[cont_name]</span></code>. If one wants to see all the docker-compose service container logs at once, then just run
<code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">logs</span> <span class="pre">-f</span></code></p></li>
</ol>
</div>
</div>
<div class="section" id="enabling-secure-boot">
<h2>Enabling Secure boot<a class="headerlink" href="#enabling-secure-boot" title="Permalink to this headline">¶</a></h2>
<p>The deployment machine with EII is recommended to be enabled with secure boot for full security.</p>
<p>For enabling secure boot with Ubuntu, please refer to : <a class="reference external" href="https://wiki.ubuntu.com/UEFI/SecureBoot">https://wiki.ubuntu.com/UEFI/SecureBoot</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With the secure boot enabled, the boot image and kernel will be verified and post that the system administrator / root user will be the security gatekeeper. The admin must ensure that the root credentials are not compromised.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright (c) 2021 Intel Corporation.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>